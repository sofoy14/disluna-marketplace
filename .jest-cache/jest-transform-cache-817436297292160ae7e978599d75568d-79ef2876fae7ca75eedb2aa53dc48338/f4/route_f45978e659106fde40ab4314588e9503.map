{"version":3,"names":["cov_1dbc94pzl6","actualCoverage","exports","POST","server_chat_helpers_1","s","require","ai_1","openai_1","__importDefault","deep_research_orchestrator_1","deep_research_prompts_1","OPENROUTER_BASE_URL","FALLBACK_USERNAME","DEFAULT_MAX_TOKENS","DEFAULT_TEMPERATURE","DEFAULT_RESEARCH_MODEL","request","f","chatSettings","messages","json","profile","resolveProfile","apiKey","b","process","env","OPENROUTER_API_KEY","openrouter_api_key","Error","client","default","baseURL","resolvedModel","model","length","userQuery","extractLastUserMessage","researchResult","runDeepResearchWorkflow","maxResearchRounds","maxSearchesPerRound","searchTimeoutMs","systemContent","DEEP_RESEARCH_SYSTEM_PROMPT","modelContext","prependOrMergeSystemMessage","logDeepResearchWorkflow","username","response","chat","completions","create","temperature","max_tokens","stream","OpenAIStream","StreamingTextResponse","error","console","message","status","Response","JSON","stringify","runtime","getServerProfile","_error","log","lastUserMessage","reverse","find","m","role","content","newContent","unshift","workflow","displayUser","truncatedQuery","slice","metadata","totalRounds","totalSearches","totalSources","totalDurationMs","finalStrategy","gapsIdentified","researchQuality","sources","forEach","source","index","title","type","url"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\tongyi\\deep-research\\route.ts"],"sourcesContent":["import { getServerProfile } from \"@/lib/server/server-chat-helpers\"\r\nimport { ChatSettings } from \"@/types\"\r\nimport { OpenAIStream, StreamingTextResponse } from \"ai\"\r\nimport OpenAI from \"openai\"\r\nimport { ChatCompletionCreateParamsBase } from \"openai/resources/chat/completions.mjs\"\r\nimport { runDeepResearchWorkflow } from \"@/lib/tongyi/deep-research-orchestrator\"\r\nimport { DEEP_RESEARCH_SYSTEM_PROMPT } from \"@/lib/tongyi/deep-research-prompts\"\r\n\r\nconst OPENROUTER_BASE_URL = \"https://openrouter.ai/api/v1\"\r\nconst FALLBACK_USERNAME = \"usuario-anonimo\"\r\nconst DEFAULT_MAX_TOKENS = 8000\nconst DEFAULT_TEMPERATURE = 0.2\nconst DEFAULT_RESEARCH_MODEL = \"alibaba/tongyi-deepresearch-30b-a3b\"\n\r\ninterface RequestBody {\r\n  chatSettings: ChatSettings\r\n  messages: Array<{ role: \"system\" | \"user\" | \"assistant\"; content: string }>\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const { chatSettings, messages } = (await request.json()) as RequestBody\r\n\r\n  try {\r\n    const profile = await resolveProfile()\r\n    const apiKey =\r\n      process.env.OPENROUTER_API_KEY || profile.openrouter_api_key || \"\"\r\n\r\n    if (!apiKey) {\r\n      throw new Error(\r\n        \"OpenRouter API Key no configurada. Define OPENROUTER_API_KEY o agrega la clave en el perfil del usuario.\"\r\n      )\r\n    }\r\n\r\n    const client = new OpenAI({\r\n      apiKey,\r\n      baseURL: OPENROUTER_BASE_URL,\r\n    })\r\n\r\n    const resolvedModel =\n      typeof chatSettings.model === \"string\" && chatSettings.model.length > 0\n        ? (chatSettings.model as string)\n        : DEFAULT_RESEARCH_MODEL\n    const userQuery = extractLastUserMessage(messages)\n\r\n    // Ejecutar el flujo de investigación profunda\r\n    const researchResult = await runDeepResearchWorkflow(userQuery, {\n      client,\n      model: resolvedModel,\n      maxResearchRounds: 6,\n      maxSearchesPerRound: 6,\n      searchTimeoutMs: 35000,\n    })\n\r\n    // Construir el contexto del sistema con los resultados de investigación\r\n    const systemContent = `${DEEP_RESEARCH_SYSTEM_PROMPT}\\n\\n${researchResult.modelContext}`\r\n    prependOrMergeSystemMessage(messages, systemContent)\r\n\r\n    logDeepResearchWorkflow(profile.username, userQuery, researchResult)\r\n\r\n    // Generar respuesta final con toda la información recopilada\r\n    const response = await client.chat.completions.create({\r\n      model: resolvedModel as ChatCompletionCreateParamsBase[\"model\"],\n      messages,\r\n      temperature: DEFAULT_TEMPERATURE,\r\n      max_tokens: DEFAULT_MAX_TOKENS,\r\n      stream: true,\r\n    })\r\n\r\n    const stream = OpenAIStream(response)\r\n    return new StreamingTextResponse(stream)\r\n  } catch (error: any) {\r\n    console.error(\"[deep-research-route] Error:\", error)\r\n    const message =\r\n      error?.error?.message ||\r\n      error?.message ||\r\n      \"Error en el sistema de investigación legal profunda\"\r\n\r\n    const status = typeof error?.status === \"number\" ? error.status : 500\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        message,\r\n        error: \"DEEP_RESEARCH_ERROR\",\r\n      }),\r\n      { status }\r\n    )\r\n  }\r\n}\r\n\r\nexport const runtime = \"edge\"\r\n\r\nasync function resolveProfile() {\r\n  try {\r\n    const profile = await getServerProfile()\r\n    return profile ?? { username: FALLBACK_USERNAME, openrouter_api_key: \"\" }\r\n  } catch (_error) {\r\n    console.log(\"[deep-research-route] Usuario no autenticado, usando configuracion por defecto\")\r\n    return { username: FALLBACK_USERNAME, openrouter_api_key: \"\" }\r\n  }\r\n}\r\n\r\nfunction extractLastUserMessage(messages: RequestBody[\"messages\"]): string {\r\n  const lastUserMessage = [...messages].reverse().find((m) => m.role === \"user\")\r\n  return typeof lastUserMessage?.content === \"string\"\r\n    ? lastUserMessage.content\r\n    : \"\"\r\n}\r\n\r\nfunction prependOrMergeSystemMessage(\r\n  messages: RequestBody[\"messages\"],\r\n  newContent: string\r\n) {\r\n  if (!messages.length || messages[0].role !== \"system\") {\r\n    messages.unshift({ role: \"system\", content: newContent })\r\n    return\r\n  }\r\n\r\n  messages[0] = {\r\n    ...messages[0],\r\n    content: `${messages[0].content}\\n\\n${newContent}`,\r\n  }\r\n}\r\n\r\nfunction logDeepResearchWorkflow(\r\n  username: string | undefined,\r\n  userQuery: string,\r\n  workflow: Awaited<ReturnType<typeof runDeepResearchWorkflow>>\r\n) {\r\n  const displayUser = username || FALLBACK_USERNAME\r\n  const truncatedQuery = userQuery.length > 120 ? `${userQuery.slice(0, 117)}...` : userQuery\r\n\r\n  console.log(\"[deep-research] ===============================\")\r\n  console.log(`[deep-research] Usuario: ${displayUser}`)\r\n  console.log(`[deep-research] Consulta: \"${truncatedQuery}\"`)\r\n  console.log(`[deep-research] Rondas de investigación: ${workflow.metadata.totalRounds}`)\r\n  console.log(`[deep-research] Búsquedas totales: ${workflow.metadata.totalSearches}`)\r\n  console.log(`[deep-research] Fuentes encontradas: ${workflow.metadata.totalSources}`)\r\n  console.log(`[deep-research] Duración total: ${workflow.metadata.totalDurationMs}ms`)\r\n  console.log(`[deep-research] Estrategia final: ${workflow.metadata.finalStrategy}`)\r\n  \r\n  if (workflow.metadata.gapsIdentified > 0) {\r\n    console.log(`[deep-research] Brechas identificadas y resueltas: ${workflow.metadata.gapsIdentified}`)\r\n  }\r\n  \r\n  console.log(`[deep-research] Calidad de investigación: ${workflow.metadata.researchQuality}/10`)\r\n  \r\n  if (workflow.sources.length > 0) {\r\n    console.log(\"[deep-research] Principales fuentes:\")\r\n    workflow.sources.slice(0, 5).forEach((source: any, index: number) => {\r\n      console.log(`  ${index + 1}. ${source.title} (${source.type}) -> ${source.url}`)\r\n    })\r\n  }\r\n  \r\n  console.log(\"[deep-research] ===============================\")\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}