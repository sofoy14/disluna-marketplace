f8279a54237d77b0a71a426c98d3d9f2
"use strict";
/**
 * Agente Unificado Tongyi para Asistente Legal
 * Versi√≥n simplificada que integra todos los sistemas existentes
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TongyiUnifiedLegalAgent = void 0;
exports.createTongyiUnifiedLegalAgent = createTongyiUnifiedLegalAgent;
const openai_1 = __importDefault(require("openai"));
const chat_memory_manager_1 = require("@/lib/memory/chat-memory-manager");
const anti_hallucination_system_1 = require("@/lib/anti-hallucination/anti-hallucination-system");
const unified_deep_research_orchestrator_1 = require("@/lib/tongyi/unified-deep-research-orchestrator");
class TongyiUnifiedLegalAgent {
    client;
    memoryManager;
    antiHallucinationSystem;
    unifiedOrchestrator;
    config;
    modelName = 'alibaba/tongyi-deepresearch-30b-a3b';
    constructor(apiKey, config = {}) {
        this.config = {
            enableMemory: true,
            enableAntiHallucination: true,
            enableContinuousVerification: true,
            legalDomain: 'colombia',
            qualityThreshold: 0.85,
            modelName: this.modelName,
            apiKey: apiKey,
            ...config
        };
        this.client = new openai_1.default({
            apiKey,
            baseURL: "https://openrouter.ai/api/v1"
        });
        this.memoryManager = chat_memory_manager_1.ChatMemoryManager.getInstance();
        this.antiHallucinationSystem = new anti_hallucination_system_1.AntiHallucinationSystem(apiKey);
        this.unifiedOrchestrator = new unified_deep_research_orchestrator_1.UnifiedDeepResearchOrchestrator(this.config);
    }
    async processLegalQuery(userQuery, chatId, userId) {
        console.log(`üöÄ TongyiUnifiedLegalAgent: Procesando consulta legal para Chat ID: ${chatId}, User ID: ${userId}`);
        try {
            // 1. Build Context (from memory)
            const chatContext = this.config.enableMemory
                ? await this.memoryManager.getChatContext(chatId, userId)
                : { currentContext: "", relevantHistory: [] };
            console.log(`üèóÔ∏è [Agent Context] Construyendo contexto para chat ${chatId}`);
            console.log(`üìä [Agent Context] Contexto construido:`);
            console.log(`   üí¨ Mensajes: ${chatContext.conversationHistory?.length || 0}`);
            console.log(`   üìÑ Fuentes cacheadas: ${chatContext.cachedSources?.length || 0}`);
            console.log(`   üìà Calidad promedio: ${chatContext.qualityMetrics?.averageQuality?.toFixed(2) || '0.80'}`);
            console.log(`   üîç Consultas anteriores: ${chatContext.searchHistory?.length || 0}`);
            // 2. Orchestrate Deep Research
            const researchResult = await this.unifiedOrchestrator.orchestrate(userQuery, chatId, userId, {
                mode: this.config.mode,
                maxRounds: this.config.maxRounds,
                maxSearchesPerRound: this.config.maxSearchesPerRound,
                enableContinuousVerification: this.config.enableContinuousVerification,
                enableIterativeRefinement: this.config.enableIterativeRefinement,
                legalDomain: this.config.legalDomain,
                qualityThreshold: this.config.qualityThreshold,
                modelName: this.modelName,
                apiKey: this.config.apiKey,
            });
            console.log(`‚úÖ TongyiUnifiedLegalAgent: Investigaci√≥n completada.`);
            return researchResult;
        }
        catch (error) {
            console.error(`‚ùå Error en TongyiUnifiedLegalAgent:`, error);
            // Return error result
            return {
                finalAnswer: `Disculpe, hubo un error procesando su consulta: ${error.message}`,
                sources: [],
                analysis: {
                    researchMode: 'react',
                    complexity: 'simple',
                    qualityScore: 0.1,
                    confidence: 0.1,
                    verificationPassed: false,
                    processingTime: 0,
                },
                recommendations: [],
                warnings: [`Error cr√≠tico: ${error.message}`],
                metadata: {
                    totalRounds: 0,
                    totalSearches: 0,
                    totalSources: 0,
                    toolsUsed: [],
                    memoryUsed: false,
                    contextRetrieved: false,
                }
            };
        }
    }
}
exports.TongyiUnifiedLegalAgent = TongyiUnifiedLegalAgent;
function createTongyiUnifiedLegalAgent(apiKey, config) {
    return new TongyiUnifiedLegalAgent(apiKey, config);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxwZWRyb1xcRG9jdW1lbnRzXFxHaXRIdWJcXEFzaXN0ZW50ZS1MZWdhbC1JbnRlbGlnZW50ZVxcbGliXFxhZ2VudHNcXHRvbmd5aS11bmlmaWVkLWxlZ2FsLWFnZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7Ozs7OztBQWlISCxzRUFFQztBQWpIRCxvREFBMkI7QUFDM0IsMEVBQW9FO0FBQ3BFLGtHQUE0RjtBQUM1Rix3R0FBK0k7QUFRL0ksTUFBYSx1QkFBdUI7SUFDMUIsTUFBTSxDQUFRO0lBQ2QsYUFBYSxDQUFtQjtJQUNoQyx1QkFBdUIsQ0FBeUI7SUFDaEQsbUJBQW1CLENBQWlDO0lBQ3BELE1BQU0sQ0FBeUI7SUFDL0IsU0FBUyxHQUFXLHFDQUFxQyxDQUFBO0lBRWpFLFlBQVksTUFBYyxFQUFFLFNBQWtDLEVBQUU7UUFDOUQsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLFlBQVksRUFBRSxJQUFJO1lBQ2xCLHVCQUF1QixFQUFFLElBQUk7WUFDN0IsNEJBQTRCLEVBQUUsSUFBSTtZQUNsQyxXQUFXLEVBQUUsVUFBVTtZQUN2QixnQkFBZ0IsRUFBRSxJQUFJO1lBQ3RCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixNQUFNLEVBQUUsTUFBTTtZQUNkLEdBQUcsTUFBTTtTQUNWLENBQUE7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksZ0JBQU0sQ0FBQztZQUN2QixNQUFNO1lBQ04sT0FBTyxFQUFFLDhCQUE4QjtTQUN4QyxDQUFDLENBQUE7UUFDRixJQUFJLENBQUMsYUFBYSxHQUFHLHVDQUFpQixDQUFDLFdBQVcsRUFBRSxDQUFBO1FBQ3BELElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLG1EQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ2xFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLG9FQUErQixDQUFDLElBQUksQ0FBQyxNQUErQixDQUFDLENBQUE7SUFDdEcsQ0FBQztJQUVNLEtBQUssQ0FBQyxpQkFBaUIsQ0FD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WSxFQUFFLENBQUM7b0JBQ2YsU0FBUyxFQUFFLEVBQUU7b0JBQ2IsVUFBVSxFQUFFLEtBQUs7b0JBQ2pCLGdCQUFnQixFQUFFLEtBQUs7aUJBQ3hCO2FBQ0YsQ0FBQTtRQUNILENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFsR0QsMERBa0dDO0FBRUQsU0FBZ0IsNkJBQTZCLENBQUMsTUFBYyxFQUFFLE1BQWdDO0lBQzVGLE9BQU8sSUFBSSx1QkFBdUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUE7QUFDcEQsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHBlZHJvXFxEb2N1bWVudHNcXEdpdEh1YlxcQXNpc3RlbnRlLUxlZ2FsLUludGVsaWdlbnRlXFxsaWJcXGFnZW50c1xcdG9uZ3lpLXVuaWZpZWQtbGVnYWwtYWdlbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEFnZW50ZSBVbmlmaWNhZG8gVG9uZ3lpIHBhcmEgQXNpc3RlbnRlIExlZ2FsXHJcbiAqIFZlcnNpw7NuIHNpbXBsaWZpY2FkYSBxdWUgaW50ZWdyYSB0b2RvcyBsb3Mgc2lzdGVtYXMgZXhpc3RlbnRlc1xyXG4gKi9cclxuXHJcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiXHJcbmltcG9ydCB7IENoYXRNZW1vcnlNYW5hZ2VyIH0gZnJvbSBcIkAvbGliL21lbW9yeS9jaGF0LW1lbW9yeS1tYW5hZ2VyXCJcclxuaW1wb3J0IHsgQW50aUhhbGx1Y2luYXRpb25TeXN0ZW0gfSBmcm9tIFwiQC9saWIvYW50aS1oYWxsdWNpbmF0aW9uL2FudGktaGFsbHVjaW5hdGlvbi1zeXN0ZW1cIlxyXG5pbXBvcnQgeyBVbmlmaWVkRGVlcFJlc2VhcmNoT3JjaGVzdHJhdG9yLCBVbmlmaWVkUmVzZWFyY2hDb25maWcsIFVuaWZpZWRSZXNlYXJjaFJlc3VsdCB9IGZyb20gXCJAL2xpYi90b25neWkvdW5pZmllZC1kZWVwLXJlc2VhcmNoLW9yY2hlc3RyYXRvclwiXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFVuaWZpZWRMZWdhbEFnZW50Q29uZmlnIGV4dGVuZHMgUGFydGlhbDxVbmlmaWVkUmVzZWFyY2hDb25maWc+IHtcclxuICBlbmFibGVNZW1vcnk/OiBib29sZWFuXHJcbiAgZW5hYmxlQW50aUhhbGx1Y2luYXRpb24/OiBib29sZWFuXHJcbiAgcHJlZmVycmVkU291cmNlcz86IHN0cmluZ1tdXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUb25neWlVbmlmaWVkTGVnYWxBZ2VudCB7XHJcbiAgcHJpdmF0ZSBjbGllbnQ6IE9wZW5BSVxyXG4gIHByaXZhdGUgbWVtb3J5TWFuYWdlcjogQ2hhdE1lbW9yeU1hbmFnZXJcclxuICBwcml2YXRlIGFudGlIYWxsdWNpbmF0aW9uU3lzdGVtOiBBbnRpSGFsbHVjaW5hdGlvblN5c3RlbVxyXG4gIHByaXZhdGUgdW5pZmllZE9yY2hlc3RyYXRvcjogVW5pZmllZERlZXBSZXNlYXJjaE9yY2hlc3RyYXRvclxyXG4gIHByaXZhdGUgY29uZmlnOiBVbmlmaWVkTGVnYWxBZ2VudENvbmZpZ1xyXG4gIHByaXZhdGUgbW9kZWxOYW1lOiBzdHJpbmcgPSAnYWxpYmFiYS90b25neWktZGVlcHJlc2VhcmNoLTMwYi1hM2InXHJcblxyXG4gIGNvbnN0cnVjdG9yKGFwaUtleTogc3RyaW5nLCBjb25maWc6IFVuaWZpZWRMZWdhbEFnZW50Q29uZmlnID0ge30pIHtcclxuICAgIHRoaXMuY29uZmlnID0ge1xyXG4gICAgICBlbmFibGVNZW1vcnk6IHRydWUsXHJcbiAgICAgIGVuYWJsZUFudGlIYWxsdWNpbmF0aW9uOiB0cnVlLFxyXG4gICAgICBlbmFibGVDb250aW51b3VzVmVyaWZpY2F0aW9uOiB0cnVlLFxyXG4gICAgICBsZWdhbERvbWFpbjogJ2NvbG9tYmlhJyxcclxuICAgICAgcXVhbGl0eVRocmVzaG9sZDogMC44NSxcclxuICAgICAgbW9kZWxOYW1lOiB0aGlzLm1vZGVsTmFtZSxcclxuICAgICAgYXBpS2V5OiBhcGlLZXksXHJcbiAgICAgIC4uLmNvbmZpZ1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2xpZW50ID0gbmV3IE9wZW5BSSh7XHJcbiAgICAgIGFwaUtleSxcclxuICAgICAgYmFzZVVSTDogXCJodHRwczovL29wZW5yb3V0ZXIuYWkvYXBpL3YxXCJcclxuICAgIH0pXHJcbiAgICB0aGlzLm1lbW9yeU1hbmFnZXIgPSBDaGF0TWVtb3J5TWFuYWdlci5nZXRJbnN0YW5jZSgpXHJcbiAgICB0aGlzLmFudGlIYWxsdWNpbmF0aW9uU3lzdGVtID0gbmV3IEFudGlIYWxsdWNpbmF0aW9uU3lzdGVtKGFwaUtleSlcclxuICAgIHRoaXMudW5pZmllZE9yY2hlc3RyYXRvciA9IG5ldyBVbmlmaWVkRGVlcFJlc2VhcmNoT3JjaGVzdHJhdG9yKHRoaXMuY29uZmlnIGFzIFVuaWZpZWRSZXNlYXJjaENvbmZpZylcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBwcm9jZXNzTGVnYWxRdWVyeShcclxuICAgIHVzZXJRdWVyeTogc3RyaW5nLFxyXG4gICAgY2hhdElkOiBzdHJpbmcsXHJcbiAgICB1c2VySWQ6IHN0cmluZyxcclxuICApOiBQcm9taXNlPFVuaWZpZWRSZXNlYXJjaFJlc3VsdD4ge1xyXG4gICAgY29uc29sZS5sb2coYPCfmoAgVG9uZ3lpVW5pZmllZExlZ2FsQWdlbnQ6IFByb2Nlc2FuZG8gY29uc3VsdGEgbGVnYWwgcGFyYSBDaGF0IElEOiAke2NoYXRJZH0sIFVzZXIgSUQ6ICR7dXNlcklkfWApXHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIDEuIEJ1aWxkIENvbnRleHQgKGZyb20gbWVtb3J5KVxyXG4gICAgICBjb25zdCBjaGF0Q29udGV4dCA9IHRoaXMuY29uZmlnLmVuYWJsZU1lbW9yeVxyXG4gICAgICAgID8gYXdhaXQgdGhpcy5tZW1vcnlNYW5hZ2VyLmdldENoYXRDb250ZXh0KGNoYXRJZCwgdXNlcklkKVxyXG4gICAgICAgIDogeyBjdXJyZW50Q29udGV4dDogXCJcIiwgcmVsZXZhbnRIaXN0b3J5OiBbXSB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhg8J+Pl++4jyBbQWdlbnQgQ29udGV4dF0gQ29uc3RydXllbmRvIGNvbnRleHRvIHBhcmEgY2hhdCAke2NoYXRJZH1gKVxyXG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBbQWdlbnQgQ29udGV4dF0gQ29udGV4dG8gY29uc3RydWlkbzpgKVxyXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+SrCBNZW5zYWplczogJHtjaGF0Q29udGV4dC5jb252ZXJzYXRpb25IaXN0b3J5Py5sZW5ndGggfHwgMH1gKVxyXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+ThCBGdWVudGVzIGNhY2hlYWRhczogJHtjaGF0Q29udGV4dC5jYWNoZWRTb3VyY2VzPy5sZW5ndGggfHwgMH1gKVxyXG4gICAgICBjb25zb2xlLmxvZyhgICAg8J+TiCBDYWxpZGFkIHByb21lZGlvOiAke2NoYXRDb250ZXh0LnF1YWxpdHlNZXRyaWNzPy5hdmVyYWdlUXVhbGl0eT8udG9GaXhlZCgyKSB8fCAnMC44MCd9YClcclxuICAgICAgY29uc29sZS5sb2coYCAgIPCflI0gQ29uc3VsdGFzIGFudGVyaW9yZXM6ICR7Y2hhdENvbnRleHQuc2VhcmNoSGlzdG9yeT8ubGVuZ3RoIHx8IDB9YClcclxuXHJcbiAgICAgIC8vIDIuIE9yY2hlc3RyYXRlIERlZXAgUmVzZWFyY2hcclxuICAgICAgY29uc3QgcmVzZWFyY2hSZXN1bHQgPSBhd2FpdCB0aGlzLnVuaWZpZWRPcmNoZXN0cmF0b3Iub3JjaGVzdHJhdGUoXHJcbiAgICAgICAgdXNlclF1ZXJ5LFxyXG4gICAgICAgIGNoYXRJZCxcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbW9kZTogdGhpcy5jb25maWcubW9kZSxcclxuICAgICAgICAgIG1heFJvdW5kczogdGhpcy5jb25maWcubWF4Um91bmRzLFxyXG4gICAgICAgICAgbWF4U2VhcmNoZXNQZXJSb3VuZDogdGhpcy5jb25maWcubWF4U2VhcmNoZXNQZXJSb3VuZCxcclxuICAgICAgICAgIGVuYWJsZUNvbnRpbnVvdXNWZXJpZmljYXRpb246IHRoaXMuY29uZmlnLmVuYWJsZUNvbnRpbnVvdXNWZXJpZmljYXRpb24sXHJcbiAgICAgICAgICBlbmFibGVJdGVyYXRpdmVSZWZpbmVtZW50OiB0aGlzLmNvbmZpZy5lbmFibGVJdGVyYXRpdmVSZWZpbmVtZW50LFxyXG4gICAgICAgICAgbGVnYWxEb21haW46IHRoaXMuY29uZmlnLmxlZ2FsRG9tYWluLFxyXG4gICAgICAgICAgcXVhbGl0eVRocmVzaG9sZDogdGhpcy5jb25maWcucXVhbGl0eVRocmVzaG9sZCxcclxuICAgICAgICAgIG1vZGVsTmFtZTogdGhpcy5tb2RlbE5hbWUsXHJcbiAgICAgICAgICBhcGlLZXk6IHRoaXMuY29uZmlnLmFwaUtleSxcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgVG9uZ3lpVW5pZmllZExlZ2FsQWdlbnQ6IEludmVzdGlnYWNpw7NuIGNvbXBsZXRhZGEuYClcclxuICAgICAgcmV0dXJuIHJlc2VhcmNoUmVzdWx0XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIGVuIFRvbmd5aVVuaWZpZWRMZWdhbEFnZW50OmAsIGVycm9yKVxyXG4gICAgICBcclxuICAgICAgLy8gUmV0dXJuIGVycm9yIHJlc3VsdFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGZpbmFsQW5zd2VyOiBgRGlzY3VscGUsIGh1Ym8gdW4gZXJyb3IgcHJvY2VzYW5kbyBzdSBjb25zdWx0YTogJHtlcnJvci5tZXNzYWdlfWAsXHJcbiAgICAgICAgc291cmNlczogW10sXHJcbiAgICAgICAgYW5hbHlzaXM6IHtcclxuICAgICAgICAgIHJlc2VhcmNoTW9kZTogJ3JlYWN0JyxcclxuICAgICAgICAgIGNvbXBsZXhpdHk6ICdzaW1wbGUnLFxyXG4gICAgICAgICAgcXVhbGl0eVNjb3JlOiAwLjEsXHJcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjEsXHJcbiAgICAgICAgICB2ZXJpZmljYXRpb25QYXNzZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgcHJvY2Vzc2luZ1RpbWU6IDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxyXG4gICAgICAgIHdhcm5pbmdzOiBbYEVycm9yIGNyw610aWNvOiAke2Vycm9yLm1lc3NhZ2V9YF0sXHJcbiAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgIHRvdGFsUm91bmRzOiAwLFxyXG4gICAgICAgICAgdG90YWxTZWFyY2hlczogMCxcclxuICAgICAgICAgIHRvdGFsU291cmNlczogMCxcclxuICAgICAgICAgIHRvb2xzVXNlZDogW10sXHJcbiAgICAgICAgICBtZW1vcnlVc2VkOiBmYWxzZSxcclxuICAgICAgICAgIGNvbnRleHRSZXRyaWV2ZWQ6IGZhbHNlLFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRvbmd5aVVuaWZpZWRMZWdhbEFnZW50KGFwaUtleTogc3RyaW5nLCBjb25maWc/OiBVbmlmaWVkTGVnYWxBZ2VudENvbmZpZyk6IFRvbmd5aVVuaWZpZWRMZWdhbEFnZW50IHtcclxuICByZXR1cm4gbmV3IFRvbmd5aVVuaWZpZWRMZWdhbEFnZW50KGFwaUtleSwgY29uZmlnKVxyXG59Il0sInZlcnNpb24iOjN9