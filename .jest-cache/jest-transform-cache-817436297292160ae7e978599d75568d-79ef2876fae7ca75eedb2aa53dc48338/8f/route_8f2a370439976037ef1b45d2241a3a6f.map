{"version":3,"names":["cov_1jb76i7u39","actualCoverage","exports","POST","generate_local_embedding_1","s","require","generate_openrouter_embedding_1","processing_1","server_chat_helpers_1","supabase_js_1","server_1","openai_1","__importDefault","req","f","supabaseAdmin","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","profile","getServerProfile","formData","file_id","get","embeddingsProvider","console","log","data","fileMetadata","error","metadataError","from","select","eq","single","b","Error","message","user_id","file","fileError","storage","download","file_path","fileBuffer","Buffer","arrayBuffer","blob","Blob","fileExtension","name","split","pop","toLowerCase","use_azure_openai","checkApiKey","azure_openai_api_key","openai_api_key","chunks","processCSV","processJSON","processMarkdown","processPdf","processTxt","NextResponse","status","embeddings","openai","default","apiKey","baseURL","azure_openai_endpoint","azure_openai_embeddings_id","defaultQuery","defaultHeaders","organization","openai_organization_id","response","create","model","input","map","chunk","content","item","embedding","openrouterKey","openrouter_api_key","OPENROUTER_API_KEY","generateMultipleOpenRouterEmbeddings","length","embeddingPromises","generateLocalEmbedding","Promise","all","file_items","index","tokens","openai_embedding","local_embedding","upsert","totalTokens","reduce","acc","update","stack","errorMessage","errorCode","Response","JSON","stringify"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\retrieval\\process\\route.ts"],"sourcesContent":["import { generateLocalEmbedding } from \"@/lib/generate-local-embedding\"\r\nimport { generateOpenRouterEmbedding, generateMultipleOpenRouterEmbeddings } from \"@/lib/generate-openrouter-embedding\"\r\nimport {\r\n  processCSV,\r\n  processJSON,\r\n  processMarkdown,\r\n  processPdf,\r\n  processTxt\r\n} from \"@/lib/retrieval/processing\"\r\nimport { checkApiKey, getServerProfile } from \"@/lib/server/server-chat-helpers\"\r\nimport { Database } from \"@/supabase/types\"\r\nimport { FileItemChunk } from \"@/types\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\nimport { NextResponse } from \"next/server\"\r\nimport OpenAI from \"openai\"\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const supabaseAdmin = createClient<Database>(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n    )\r\n\r\n    const profile = await getServerProfile()\r\n\r\n    const formData = await req.formData()\r\n\r\n    const file_id = formData.get(\"file_id\") as string\r\n    let embeddingsProvider = formData.get(\"embeddingsProvider\") as string\r\n    \r\n    // ðŸ”¥ FORZAR OpenAI Embeddings - SOLUCIÃ“N DEFINITIVA\r\n    // OpenRouter no tiene embeddings, local tiene problemas de descarga\r\n    // OpenAI embeddings son baratos (~$0.0001/1K tokens) y muy confiables\r\n    embeddingsProvider = \"openai\"\r\n    console.log(\"ðŸ”¥ FORZANDO embeddingsProvider a 'openai' (mÃ¡s confiable y econÃ³mico)\")\r\n\r\n    const { data: fileMetadata, error: metadataError } = await supabaseAdmin\r\n      .from(\"files\")\r\n      .select(\"*\")\r\n      .eq(\"id\", file_id)\r\n      .single()\r\n\r\n    if (metadataError) {\r\n      throw new Error(\r\n        `Failed to retrieve file metadata: ${metadataError.message}`\r\n      )\r\n    }\r\n\r\n    if (!fileMetadata) {\r\n      throw new Error(\"File not found\")\r\n    }\r\n\r\n    if (fileMetadata.user_id !== profile.user_id) {\r\n      throw new Error(\"Unauthorized\")\r\n    }\r\n\r\n    const { data: file, error: fileError } = await supabaseAdmin.storage\r\n      .from(\"files\")\r\n      .download(fileMetadata.file_path)\r\n\r\n    if (fileError)\r\n      throw new Error(`Failed to retrieve file: ${fileError.message}`)\r\n\r\n    const fileBuffer = Buffer.from(await file.arrayBuffer())\r\n    const blob = new Blob([fileBuffer])\r\n    const fileExtension = fileMetadata.name.split(\".\").pop()?.toLowerCase()\r\n\r\n    // ============================================\r\n    // CONFIGURACIÃ“N DE EMBEDDINGS PROVIDER\r\n    // ============================================\r\n    // Por defecto, usar OpenRouter (sin necesidad de OpenAI API key)\r\n    if (!embeddingsProvider || embeddingsProvider === \"\") {\r\n      embeddingsProvider = \"openrouter\"\r\n      console.log(\"ðŸ“Œ Embeddings provider no especificado, usando OpenRouter por defecto\")\r\n    }\r\n\r\n    console.log(`ðŸ“Œ Embeddings provider seleccionado: ${embeddingsProvider}`)\r\n\r\n    // Verificar API keys segÃºn el proveedor\r\n    if (embeddingsProvider === \"openai\") {\r\n      // Para OpenAI (preferido para embeddings)\r\n      try {\r\n        if (profile.use_azure_openai) {\r\n          checkApiKey(profile.azure_openai_api_key, \"Azure OpenAI\")\r\n          console.log(\"âœ… Azure OpenAI API Key found\")\r\n        } else {\r\n          checkApiKey(profile.openai_api_key, \"OpenAI\")\r\n          console.log(\"âœ… OpenAI API Key found\")\r\n        }\r\n      } catch (error: any) {\r\n        throw new Error(`âŒ OpenAI API Key not found. Embeddings require an OpenAI API key. Error: ${error.message}`)\r\n      }\r\n    } else if (embeddingsProvider !== \"local\") {\r\n      console.log(`âš ï¸ Unknown embeddings provider: ${embeddingsProvider}, defaulting to openai`)\r\n      embeddingsProvider = \"openai\"\r\n    }\r\n\r\n    let chunks: FileItemChunk[] = []\r\n\r\n    switch (fileExtension) {\r\n      case \"csv\":\r\n        chunks = await processCSV(blob)\r\n        break\r\n      case \"json\":\r\n        chunks = await processJSON(blob)\r\n        break\r\n      case \"md\":\r\n        chunks = await processMarkdown(blob)\r\n        break\r\n      case \"pdf\":\r\n        chunks = await processPdf(blob)\r\n        break\r\n      case \"txt\":\r\n        chunks = await processTxt(blob)\r\n        break\r\n      default:\r\n        return new NextResponse(\"Unsupported file type\", {\r\n          status: 400\r\n        })\r\n    }\r\n\r\n    let embeddings: any = []\r\n\r\n    let openai\r\n    if (profile.use_azure_openai) {\r\n      openai = new OpenAI({\r\n        apiKey: profile.azure_openai_api_key || \"\",\r\n        baseURL: `${profile.azure_openai_endpoint}/openai/deployments/${profile.azure_openai_embeddings_id}`,\r\n        defaultQuery: { \"api-version\": \"2023-12-01-preview\" },\r\n        defaultHeaders: { \"api-key\": profile.azure_openai_api_key }\r\n      })\r\n    } else {\r\n      openai = new OpenAI({\r\n        apiKey: profile.openai_api_key || \"\",\r\n        organization: profile.openai_organization_id\r\n      })\r\n    }\r\n\r\n    if (embeddingsProvider === \"openai\") {\r\n      const response = await openai.embeddings.create({\r\n        model: \"text-embedding-3-small\",\r\n        input: chunks.map(chunk => chunk.content)\r\n      })\r\n\r\n      embeddings = response.data.map((item: any) => {\r\n        return item.embedding\r\n      })\r\n    } else if (embeddingsProvider === \"openrouter\") {\r\n      // ðŸ”¥ USAR OpenRouter para embeddings\r\n      console.log('ðŸš€ Using OpenRouter embeddings for document processing')\r\n      const openrouterKey = profile.openrouter_api_key || process.env.OPENROUTER_API_KEY\r\n      \r\n      embeddings = await generateMultipleOpenRouterEmbeddings(\r\n        chunks.map(chunk => chunk.content),\r\n        openrouterKey!\r\n      )\r\n      \r\n      console.log(`âœ… Generated ${embeddings.length} OpenRouter embeddings`)\r\n    } else {\r\n      // Usar embeddings locales solo si se especifica explÃ­citamente\r\n      console.log('Using local embeddings for document processing')\r\n      const embeddingPromises = chunks.map(async chunk => {\r\n        try {\r\n          return await generateLocalEmbedding(chunk.content)\r\n        } catch (error) {\r\n          console.error(`Error generating embedding for chunk: ${chunk}`, error)\r\n          return null\r\n        }\r\n      })\r\n\r\n      embeddings = await Promise.all(embeddingPromises)\r\n    }\r\n\r\n    const file_items = chunks.map((chunk, index) => ({\r\n      file_id,\r\n      user_id: profile.user_id,\r\n      content: chunk.content,\r\n      tokens: chunk.tokens,\r\n      openai_embedding:\r\n        embeddingsProvider === \"openai\" || embeddingsProvider === \"openrouter\"\r\n          ? ((embeddings[index] || null) as any)\r\n          : null,\r\n      local_embedding:\r\n        embeddingsProvider === \"local\"\r\n          ? ((embeddings[index] || null) as any)\r\n          : null\r\n    }))\r\n\r\n    await supabaseAdmin.from(\"file_items\").upsert(file_items)\r\n\r\n    const totalTokens = file_items.reduce((acc, item) => acc + item.tokens, 0)\r\n\r\n    await supabaseAdmin\r\n      .from(\"files\")\r\n      .update({ tokens: totalTokens })\r\n      .eq(\"id\", file_id)\r\n\r\n    return new NextResponse(\"Embed Successful\", {\r\n      status: 200\r\n    })\r\n  } catch (error: any) {\r\n    console.log(`Error in retrieval/process: ${error.stack}`)\r\n    const errorMessage = error?.message || \"An unexpected error occurred\"\r\n    const errorCode = error.status || 500\r\n    return new Response(JSON.stringify({ message: errorMessage }), {\r\n      status: errorCode\r\n    })\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}