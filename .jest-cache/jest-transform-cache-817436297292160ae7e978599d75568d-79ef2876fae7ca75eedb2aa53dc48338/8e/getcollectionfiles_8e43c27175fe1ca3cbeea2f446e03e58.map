{"version":3,"names":["exports","getCollectionFiles","cov_5whzuhbwn","s","getAllCollectionsWithFiles","getCollectionFileIds","robust_client_1","require","collectionId","f","data","collection","error","collectionError","supabase","from","select","eq","single","b","console","collectionFiles","filesError","files","map","cf","filter","file","id","name","description","collections","collectionsError","order","collectionsWithFiles","Promise","all","collectionWithFiles","file_id"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\collections\\get-collection-files.ts"],"sourcesContent":["import { supabase } from \"@/lib/supabase/robust-client\"\r\nimport { Tables } from \"@/supabase/types\"\r\n\r\nexport interface CollectionWithFiles {\r\n  id: string\r\n  name: string\r\n  description: string | null\r\n  files: Tables<\"files\">[]\r\n}\r\n\r\n/**\r\n * Obtiene todos los archivos de una colección específica\r\n */\r\nexport async function getCollectionFiles(collectionId: string): Promise<CollectionWithFiles | null> {\r\n  try {\r\n    // Primero obtener la información de la colección\r\n    const { data: collection, error: collectionError } = await supabase\r\n      .from(\"collections\")\r\n      .select(\"*\")\r\n      .eq(\"id\", collectionId)\r\n      .single()\r\n\r\n    if (collectionError) {\r\n      console.error(\"Error obteniendo colección:\", collectionError)\r\n      return null\r\n    }\r\n\r\n    if (!collection) {\r\n      return null\r\n    }\r\n\r\n    // Obtener los archivos de la colección a través de collection_files\r\n    const { data: collectionFiles, error: filesError } = await supabase\r\n      .from(\"collection_files\")\r\n      .select(`\r\n        file_id,\r\n        files (\r\n          id,\r\n          name,\r\n          type,\r\n          description,\r\n          file_path,\r\n          size,\r\n          tokens,\r\n          user_id,\r\n          created_at,\r\n          updated_at\r\n        )\r\n      `)\r\n      .eq(\"collection_id\", collectionId)\r\n\r\n    if (filesError) {\r\n      console.error(\"Error obteniendo archivos de la colección:\", filesError)\r\n      return null\r\n    }\r\n\r\n    // Extraer los archivos del resultado\r\n    const files = collectionFiles\r\n      ?.map(cf => cf.files)\r\n      .filter(file => file !== null) as Tables<\"files\">[] || []\r\n\r\n    return {\r\n      id: collection.id,\r\n      name: collection.name,\r\n      description: collection.description,\r\n      files\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error en getCollectionFiles:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene todas las colecciones con sus archivos\r\n */\r\nexport async function getAllCollectionsWithFiles(): Promise<CollectionWithFiles[]> {\r\n  try {\r\n    const { data: collections, error: collectionsError } = await supabase\r\n      .from(\"collections\")\r\n      .select(\"*\")\r\n      .order(\"name\")\r\n\r\n    if (collectionsError) {\r\n      console.error(\"Error obteniendo colecciones:\", collectionsError)\r\n      return []\r\n    }\r\n\r\n    if (!collections) {\r\n      return []\r\n    }\r\n\r\n    // Para cada colección, obtener sus archivos\r\n    const collectionsWithFiles = await Promise.all(\r\n      collections.map(async (collection) => {\r\n        const collectionWithFiles = await getCollectionFiles(collection.id)\r\n        return collectionWithFiles || {\r\n          id: collection.id,\r\n          name: collection.name,\r\n          description: collection.description,\r\n          files: []\r\n        }\r\n      })\r\n    )\r\n\r\n    return collectionsWithFiles\r\n  } catch (error) {\r\n    console.error(\"Error en getAllCollectionsWithFiles:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene los IDs de archivos de una colección\r\n */\r\nexport async function getCollectionFileIds(collectionId: string): Promise<string[]> {\r\n  try {\r\n    const { data: collectionFiles, error } = await supabase\r\n      .from(\"collection_files\")\r\n      .select(\"file_id\")\r\n      .eq(\"collection_id\", collectionId)\r\n\r\n    if (error) {\r\n      console.error(\"Error obteniendo IDs de archivos:\", error)\r\n      return []\r\n    }\r\n\r\n    return collectionFiles?.map(cf => cf.file_id) || []\r\n  } catch (error) {\r\n    console.error(\"Error en getCollectionFileIds:\", error)\r\n    return []\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}