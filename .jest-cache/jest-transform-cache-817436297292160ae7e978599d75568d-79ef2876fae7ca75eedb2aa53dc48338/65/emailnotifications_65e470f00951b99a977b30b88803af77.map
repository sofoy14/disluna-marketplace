{"version":3,"names":["exports","sendEmail","cov_felx4v4l1","s","emailTemplates","paymentSuccess","invoice","f","subject","id","html","formatCurrency","amount_in_cents","Date","period_start","toLocaleDateString","period_end","paid_at","text","paymentFailed","attempt","b","process","env","NEXT_PUBLIC_APP_URL","subscriptionSuspended","subscription","plans","name","paymentMethodExpiring","paymentSource","type","last_four","expires_at","amountInCents","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","to","template","console","log","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","error"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\billing\\email-notifications.ts"],"sourcesContent":["// lib/billing/email-notifications.ts\r\nexport interface EmailTemplate {\r\n  subject: string;\r\n  html: string;\r\n  text: string;\r\n}\r\n\r\nexport const emailTemplates = {\r\n  paymentSuccess: (invoice: any): EmailTemplate => ({\r\n    subject: `Pago exitoso - Factura ${invoice.id}`,\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n        <h2 style=\"color: #22c55e;\">‚úÖ Pago Exitoso</h2>\r\n        <p>Hola,</p>\r\n        <p>Tu pago de <strong>${formatCurrency(invoice.amount_in_cents)}</strong> ha sido procesado exitosamente.</p>\r\n        <div style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;\">\r\n          <h3>Detalles del Pago</h3>\r\n          <p><strong>Factura:</strong> ${invoice.id}</p>\r\n          <p><strong>Per√≠odo:</strong> ${new Date(invoice.period_start).toLocaleDateString('es-CO')} - ${new Date(invoice.period_end).toLocaleDateString('es-CO')}</p>\r\n          <p><strong>Monto:</strong> ${formatCurrency(invoice.amount_in_cents)}</p>\r\n          <p><strong>Fecha de pago:</strong> ${new Date(invoice.paid_at).toLocaleDateString('es-CO')}</p>\r\n        </div>\r\n        <p>Gracias por tu confianza. Tu suscripci√≥n est√° activa.</p>\r\n        <p>Saludos,<br>El equipo de Asistente Legal Inteligente</p>\r\n      </div>\r\n    `,\r\n    text: `Pago exitoso de ${formatCurrency(invoice.amount_in_cents)}. Factura ${invoice.id}. Per√≠odo: ${new Date(invoice.period_start).toLocaleDateString('es-CO')} - ${new Date(invoice.period_end).toLocaleDateString('es-CO')}.`\r\n  }),\r\n\r\n  paymentFailed: (invoice: any, attempt: number): EmailTemplate => ({\r\n    subject: `Pago rechazado - Intento ${attempt} de 3`,\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n        <h2 style=\"color: #ef4444;\">‚ö†Ô∏è Pago Rechazado</h2>\r\n        <p>Hola,</p>\r\n        <p>Tu pago de <strong>${formatCurrency(invoice.amount_in_cents)}</strong> no pudo ser procesado.</p>\r\n        <div style=\"background: #fef2f2; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ef4444;\">\r\n          <h3>Detalles del Pago</h3>\r\n          <p><strong>Factura:</strong> ${invoice.id}</p>\r\n          <p><strong>Monto:</strong> ${formatCurrency(invoice.amount_in_cents)}</p>\r\n          <p><strong>Intento:</strong> ${attempt} de 3</p>\r\n          <p><strong>Pr√≥ximo intento:</strong> ${attempt < 3 ? 'En 2 d√≠as' : 'No hay m√°s intentos autom√°ticos'}</p>\r\n        </div>\r\n        ${attempt < 3 ? `\r\n          <p><strong>¬øQu√© puedes hacer?</strong></p>\r\n          <ul>\r\n            <li>Verifica que tu m√©todo de pago tenga fondos suficientes</li>\r\n            <li>Actualiza tu m√©todo de pago si es necesario</li>\r\n            <li>Contacta a tu banco si el problema persiste</li>\r\n          </ul>\r\n        ` : `\r\n          <p><strong>Acci√≥n requerida:</strong></p>\r\n          <p>Tu suscripci√≥n ser√° suspendida si no actualizas tu m√©todo de pago. <a href=\"${process.env.NEXT_PUBLIC_APP_URL}/billing\" style=\"color: #3b82f6;\">Actualizar m√©todo de pago</a></p>\r\n        `}\r\n        <p>Si tienes preguntas, cont√°ctanos.</p>\r\n        <p>Saludos,<br>El equipo de Asistente Legal Inteligente</p>\r\n      </div>\r\n    `,\r\n    text: `Pago rechazado de ${formatCurrency(invoice.amount_in_cents)}. Intento ${attempt} de 3. ${attempt < 3 ? 'Pr√≥ximo intento en 2 d√≠as.' : 'Actualiza tu m√©todo de pago.'}`\r\n  }),\r\n\r\n  subscriptionSuspended: (subscription: any): EmailTemplate => ({\r\n    subject: 'Suscripci√≥n suspendida - Acci√≥n requerida',\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n        <h2 style=\"color: #ef4444;\">üö´ Suscripci√≥n Suspendida</h2>\r\n        <p>Hola,</p>\r\n        <p>Tu suscripci√≥n ha sido suspendida debido a fallos repetidos en el procesamiento del pago.</p>\r\n        <div style=\"background: #fef2f2; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ef4444;\">\r\n          <h3>Detalles de la Suscripci√≥n</h3>\r\n          <p><strong>Plan:</strong> ${subscription.plans?.name || 'N/A'}</p>\r\n          <p><strong>Estado:</strong> Suspendida</p>\r\n          <p><strong>Fecha de suspensi√≥n:</strong> ${new Date().toLocaleDateString('es-CO')}</p>\r\n        </div>\r\n        <p><strong>Para reactivar tu suscripci√≥n:</strong></p>\r\n        <ol>\r\n          <li>Actualiza tu m√©todo de pago</li>\r\n          <li>Realiza el pago pendiente</li>\r\n          <li>Tu acceso ser√° restaurado inmediatamente</li>\r\n        </ol>\r\n        <div style=\"text-align: center; margin: 30px 0;\">\r\n          <a href=\"${process.env.NEXT_PUBLIC_APP_URL}/billing\" style=\"background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;\">Actualizar M√©todo de Pago</a>\r\n        </div>\r\n        <p>Si necesitas ayuda, cont√°ctanos.</p>\r\n        <p>Saludos,<br>El equipo de Asistente Legal Inteligente</p>\r\n      </div>\r\n    `,\r\n    text: `Suscripci√≥n suspendida. Actualiza tu m√©todo de pago para reactivar: ${process.env.NEXT_PUBLIC_APP_URL}/billing`\r\n  }),\r\n\r\n  paymentMethodExpiring: (paymentSource: any): EmailTemplate => ({\r\n    subject: 'Tu m√©todo de pago est√° pr√≥ximo a vencer',\r\n    html: `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n        <h2 style=\"color: #f59e0b;\">‚ö†Ô∏è M√©todo de Pago Pr√≥ximo a Vencer</h2>\r\n        <p>Hola,</p>\r\n        <p>Tu m√©todo de pago est√° pr√≥ximo a vencer y necesita ser actualizado.</p>\r\n        <div style=\"background: #fffbeb; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #f59e0b;\">\r\n          <h3>Detalles del M√©todo de Pago</h3>\r\n          <p><strong>Tipo:</strong> ${paymentSource.type}</p>\r\n          <p><strong>√öltimos 4 d√≠gitos:</strong> ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ${paymentSource.last_four}</p>\r\n          <p><strong>Fecha de vencimiento:</strong> ${new Date(paymentSource.expires_at).toLocaleDateString('es-CO')}</p>\r\n        </div>\r\n        <p><strong>Para evitar interrupciones en tu servicio:</strong></p>\r\n        <ol>\r\n          <li>Actualiza tu m√©todo de pago antes de la fecha de vencimiento</li>\r\n          <li>Tu suscripci√≥n continuar√° sin interrupciones</li>\r\n        </ol>\r\n        <div style=\"text-align: center; margin: 30px 0;\">\r\n          <a href=\"${process.env.NEXT_PUBLIC_APP_URL}/billing\" style=\"background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;\">Actualizar M√©todo de Pago</a>\r\n        </div>\r\n        <p>Si tienes preguntas, cont√°ctanos.</p>\r\n        <p>Saludos,<br>El equipo de Asistente Legal Inteligente</p>\r\n      </div>\r\n    `,\r\n    text: `M√©todo de pago pr√≥ximo a vencer (${new Date(paymentSource.expires_at).toLocaleDateString('es-CO')}). Actualiza en: ${process.env.NEXT_PUBLIC_APP_URL}/billing`\r\n  })\r\n};\r\n\r\n// Funci√≥n helper para formatear moneda\r\nfunction formatCurrency(amountInCents: number): string {\r\n  return new Intl.NumberFormat('es-CO', {\r\n    style: 'currency',\r\n    currency: 'COP',\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0\r\n  }).format(amountInCents);\r\n}\r\n\r\n// Funci√≥n para enviar emails (implementar seg√∫n tu proveedor de email)\r\nexport async function sendEmail(to: string, template: EmailTemplate): Promise<void> {\r\n  // Implementar seg√∫n tu proveedor de email (SendGrid, Resend, etc.)\r\n  console.log(`Sending email to ${to}:`, template.subject);\r\n  \r\n  // Ejemplo con fetch a tu API de email\r\n  try {\r\n    const response = await fetch('/api/send-email', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        to,\r\n        subject: template.subject,\r\n        html: template.html,\r\n        text: template.text\r\n      })\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to send email: ${response.statusText}`);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error sending email:', error);\r\n    // En producci√≥n, podr√≠as querer usar un servicio de cola como BullMQ\r\n    // para reintentar el env√≠o de emails\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkIAA,OAAA,CAAAC,SAAA,GAAAA,SAAA;AAyBC;AAAAC,aAAA,GAAAC,CAAA;AApJYH,OAAA,CAAAI,cAAc,GAAG;EAC5BC,cAAc,EAAGC,OAAY,IAAqB;IAAA;IAAAJ,aAAA,GAAAK,CAAA;IAAAL,aAAA,GAAAC,CAAA;IAAA;MAChDK,OAAO,EAAE,0BAA0BF,OAAO,CAACG,EAAE,EAAE;MAC/CC,IAAI,EAAE;;;;gCAIsBC,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC;;;yCAG9BN,OAAO,CAACG,EAAE;yCACV,IAAII,IAAI,CAACP,OAAO,CAACQ,YAAY,CAAC,CAACC,kBAAkB,CAAC,OAAO,CAAC,MAAM,IAAIF,IAAI,CAACP,OAAO,CAACU,UAAU,CAAC,CAACD,kBAAkB,CAAC,OAAO,CAAC;uCAC1HJ,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC;+CAC/B,IAAIC,IAAI,CAACP,OAAO,CAACW,OAAO,CAAC,CAACF,kBAAkB,CAAC,OAAO,CAAC;;;;;KAK/F;MACDG,IAAI,EAAE,mBAAmBP,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC,aAAaN,OAAO,CAACG,EAAE,cAAc,IAAII,IAAI,CAACP,OAAO,CAACQ,YAAY,CAAC,CAACC,kBAAkB,CAAC,OAAO,CAAC,MAAM,IAAIF,IAAI,CAACP,OAAO,CAACU,UAAU,CAAC,CAACD,kBAAkB,CAAC,OAAO,CAAC;KAC9N;GAAC;EAEFI,aAAa,EAAEA,CAACb,OAAY,EAAEc,OAAe,KAAqB;IAAA;IAAAlB,aAAA,GAAAK,CAAA;IAAAL,aAAA,GAAAC,CAAA;IAAA;MAChEK,OAAO,EAAE,4BAA4BY,OAAO,OAAO;MACnDV,IAAI,EAAE;;;;gCAIsBC,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC;;;yCAG9BN,OAAO,CAACG,EAAE;uCACZE,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC;yCACrCQ,OAAO;iDACCA,OAAO,GAAG,CAAC;MAAA;MAAA,CAAAlB,aAAA,GAAAmB,CAAA,UAAG,WAAW;MAAA;MAAA,CAAAnB,aAAA,GAAAmB,CAAA,UAAG,iCAAiC;;UAEpGD,OAAO,GAAG,CAAC;MAAA;MAAA,CAAAlB,aAAA,GAAAmB,CAAA,UAAG;;;;;;;SAOf;MAAA;MAAA,CAAAnB,aAAA,GAAAmB,CAAA,UAAG;;2FAE+EC,OAAO,CAACC,GAAG,CAACC,mBAAmB;SACjH;;;;KAIJ;MACDN,IAAI,EAAE,qBAAqBP,cAAc,CAACL,OAAO,CAACM,eAAe,CAAC,aAAaQ,OAAO,UAAUA,OAAO,GAAG,CAAC;MAAA;MAAA,CAAAlB,aAAA,GAAAmB,CAAA,UAAG,4BAA4B;MAAA;MAAA,CAAAnB,aAAA,GAAAmB,CAAA,UAAG,8BAA8B;KAC5K;GAAC;EAEFI,qBAAqB,EAAGC,YAAiB,IAAqB;IAAA;IAAAxB,aAAA,GAAAK,CAAA;IAAAL,aAAA,GAAAC,CAAA;IAAA;MAC5DK,OAAO,EAAE,2CAA2C;MACpDE,IAAI,EAAE;;;;;;;;MAO4B;MAAA,CAAAR,aAAA,GAAAmB,CAAA,UAAAK,YAAY,CAACC,KAAK,EAAEC,IAAI;MAAA;MAAA,CAAA1B,aAAA,GAAAmB,CAAA,UAAI,KAAK;;qDAElB,IAAIR,IAAI,EAAE,CAACE,kBAAkB,CAAC,OAAO,CAAC;;;;;;;;;qBAStEO,OAAO,CAACC,GAAG,CAACC,mBAAmB;;;;;KAK/C;MACDN,IAAI,EAAE,uEAAuEI,OAAO,CAACC,GAAG,CAACC,mBAAmB;KAC7G;GAAC;EAEFK,qBAAqB,EAAGC,aAAkB,IAAqB;IAAA;IAAA5B,aAAA,GAAAK,CAAA;IAAAL,aAAA,GAAAC,CAAA;IAAA;MAC7DK,OAAO,EAAE,yCAAyC;MAClDE,IAAI,EAAE;;;;;;;sCAO4BoB,aAAa,CAACC,IAAI;wDACAD,aAAa,CAACE,SAAS;sDACzB,IAAInB,IAAI,CAACiB,aAAa,CAACG,UAAU,CAAC,CAAClB,kBAAkB,CAAC,OAAO,CAAC;;;;;;;;qBAQ/FO,OAAO,CAACC,GAAG,CAACC,mBAAmB;;;;;KAK/C;MACDN,IAAI,EAAE,oCAAoC,IAAIL,IAAI,CAACiB,aAAa,CAACG,UAAU,CAAC,CAAClB,kBAAkB,CAAC,OAAO,CAAC,oBAAoBO,OAAO,CAACC,GAAG,CAACC,mBAAmB;KAC5J;;CACF;AAED;AACA,SAASb,cAAcA,CAACuB,aAAqB;EAAA;EAAAhC,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAC,CAAA;EAC3C,OAAO,IAAIgC,IAAI,CAACC,YAAY,CAAC,OAAO,EAAE;IACpCC,KAAK,EAAE,UAAU;IACjBC,QAAQ,EAAE,KAAK;IACfC,qBAAqB,EAAE,CAAC;IACxBC,qBAAqB,EAAE;GACxB,CAAC,CAACC,MAAM,CAACP,aAAa,CAAC;AAC1B;AAEA;AACO,eAAejC,SAASA,CAACyC,EAAU,EAAEC,QAAuB;EAAA;EAAAzC,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAC,CAAA;EACjE;EACAyC,OAAO,CAACC,GAAG,CAAC,oBAAoBH,EAAE,GAAG,EAAEC,QAAQ,CAACnC,OAAO,CAAC;EAExD;EAAA;EAAAN,aAAA,GAAAC,CAAA;EACA,IAAI;IACF,MAAM2C,QAAQ;IAAA;IAAA,CAAA5C,aAAA,GAAAC,CAAA,QAAG,MAAM4C,KAAK,CAAC,iBAAiB,EAAE;MAC9CC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAkB,CAAE;MAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QACnBV,EAAE;QACFlC,OAAO,EAAEmC,QAAQ,CAACnC,OAAO;QACzBE,IAAI,EAAEiC,QAAQ,CAACjC,IAAI;QACnBQ,IAAI,EAAEyB,QAAQ,CAACzB;OAChB;KACF,CAAC;IAAC;IAAAhB,aAAA,GAAAC,CAAA;IAEH,IAAI,CAAC2C,QAAQ,CAACO,EAAE,EAAE;MAAA;MAAAnD,aAAA,GAAAmB,CAAA;MAAAnB,aAAA,GAAAC,CAAA;MAChB,MAAM,IAAImD,KAAK,CAAC,yBAAyBR,QAAQ,CAACS,UAAU,EAAE,CAAC;IACjE,CAAC;IAAA;IAAA;MAAArD,aAAA,GAAAmB,CAAA;IAAA;EACH,CAAC,CAAC,OAAOmC,KAAK,EAAE;IAAA;IAAAtD,aAAA,GAAAC,CAAA;IACdyC,OAAO,CAACY,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC5C;IACA;EACF;AACF","ignoreList":[]}