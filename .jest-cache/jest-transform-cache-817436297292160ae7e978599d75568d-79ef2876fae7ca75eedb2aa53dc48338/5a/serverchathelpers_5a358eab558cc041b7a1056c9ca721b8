394b79ffda8a7264266aa7ca3add2b9c
"use strict";

/* istanbul ignore next */
function cov_aie0flvqh() {
  var path = "C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\server\\server-chat-helpers.ts";
  var hash = "0447b505423f97498979fdccd1509302127be570";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\server\\server-chat-helpers.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 2,
          column: 62
        }
      },
      "1": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 3,
          column: 44
        }
      },
      "2": {
        start: {
          line: 4,
          column: 0
        },
        end: {
          line: 4,
          column: 34
        }
      },
      "3": {
        start: {
          line: 5,
          column: 21
        },
        end: {
          line: 5,
          column: 50
        }
      },
      "4": {
        start: {
          line: 6,
          column: 14
        },
        end: {
          line: 6,
          column: 38
        }
      },
      "5": {
        start: {
          line: 7,
          column: 18
        },
        end: {
          line: 7,
          column: 41
        }
      },
      "6": {
        start: {
          line: 9,
          column: 24
        },
        end: {
          line: 9,
          column: 48
        }
      },
      "7": {
        start: {
          line: 10,
          column: 21
        },
        end: {
          line: 16,
          column: 6
        }
      },
      "8": {
        start: {
          line: 13,
          column: 16
        },
        end: {
          line: 13,
          column: 52
        }
      },
      "9": {
        start: {
          line: 17,
          column: 17
        },
        end: {
          line: 17,
          column: 58
        }
      },
      "10": {
        start: {
          line: 18,
          column: 4
        },
        end: {
          line: 20,
          column: 5
        }
      },
      "11": {
        start: {
          line: 19,
          column: 8
        },
        end: {
          line: 19,
          column: 42
        }
      },
      "12": {
        start: {
          line: 21,
          column: 30
        },
        end: {
          line: 25,
          column: 17
        }
      },
      "13": {
        start: {
          line: 26,
          column: 4
        },
        end: {
          line: 28,
          column: 5
        }
      },
      "14": {
        start: {
          line: 27,
          column: 8
        },
        end: {
          line: 27,
          column: 45
        }
      },
      "15": {
        start: {
          line: 29,
          column: 28
        },
        end: {
          line: 29,
          column: 56
        }
      },
      "16": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 27
        }
      },
      "17": {
        start: {
          line: 33,
          column: 20
        },
        end: {
          line: 48,
          column: 5
        }
      },
      "18": {
        start: {
          line: 49,
          column: 4
        },
        end: {
          line: 54,
          column: 5
        }
      },
      "19": {
        start: {
          line: 50,
          column: 8
        },
        end: {
          line: 53,
          column: 9
        }
      },
      "20": {
        start: {
          line: 52,
          column: 12
        },
        end: {
          line: 52,
          column: 54
        }
      },
      "21": {
        start: {
          line: 55,
          column: 4
        },
        end: {
          line: 55,
          column: 19
        }
      },
      "22": {
        start: {
          line: 58,
          column: 4
        },
        end: {
          line: 60,
          column: 5
        }
      },
      "23": {
        start: {
          line: 59,
          column: 8
        },
        end: {
          line: 59,
          column: 56
        }
      }
    },
    fnMap: {
      "0": {
        name: "getServerProfile",
        decl: {
          start: {
            line: 8,
            column: 15
          },
          end: {
            line: 8,
            column: 31
          }
        },
        loc: {
          start: {
            line: 8,
            column: 34
          },
          end: {
            line: 31,
            column: 1
          }
        },
        line: 8
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 12
          },
          end: {
            line: 12,
            column: 13
          }
        },
        loc: {
          start: {
            line: 12,
            column: 22
          },
          end: {
            line: 14,
            column: 13
          }
        },
        line: 12
      },
      "2": {
        name: "addApiKeysToProfile",
        decl: {
          start: {
            line: 32,
            column: 9
          },
          end: {
            line: 32,
            column: 28
          }
        },
        loc: {
          start: {
            line: 32,
            column: 38
          },
          end: {
            line: 56,
            column: 1
          }
        },
        line: 32
      },
      "3": {
        name: "checkApiKey",
        decl: {
          start: {
            line: 57,
            column: 9
          },
          end: {
            line: 57,
            column: 20
          }
        },
        loc: {
          start: {
            line: 57,
            column: 38
          },
          end: {
            line: 61,
            column: 1
          }
        },
        line: 57
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 18,
            column: 4
          },
          end: {
            line: 20,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 18,
            column: 4
          },
          end: {
            line: 20,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 18
      },
      "1": {
        loc: {
          start: {
            line: 26,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 26,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 26
      },
      "2": {
        loc: {
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 53,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 53,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 50
      },
      "3": {
        loc: {
          start: {
            line: 58,
            column: 4
          },
          end: {
            line: 60,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 58,
            column: 4
          },
          end: {
            line: 60,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 58
      },
      "4": {
        loc: {
          start: {
            line: 58,
            column: 8
          },
          end: {
            line: 58,
            column: 40
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 58,
            column: 8
          },
          end: {
            line: 58,
            column: 23
          }
        }, {
          start: {
            line: 58,
            column: 27
          },
          end: {
            line: 58,
            column: 40
          }
        }],
        line: 58
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0]
    },
    inputSourceMap: {
      file: "C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\server\\server-chat-helpers.ts",
      mappings: ";;AAKA,4CAgCC;AA+BD,kCAIC;AAvED,mDAAmD;AACnD,uCAAkD;AAClD,0CAAsC;AAE/B,KAAK,UAAU,gBAAgB;IACpC,MAAM,WAAW,GAAG,IAAA,iBAAO,GAAE,CAAA;IAC7B,MAAM,QAAQ,GAAG,IAAA,wBAAkB,EACjC,OAAO,CAAC,GAAG,CAAC,wBAAyB,EACrC,OAAO,CAAC,GAAG,CAAC,6BAA8B,EAC1C;QACE,OAAO,EAAE;YACP,GAAG,CAAC,IAAY;gBACd,OAAO,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,KAAK,CAAA;YACrC,CAAC;SACF;KACF,CACF,CAAA;IAED,MAAM,IAAI,GAAG,CAAC,MAAM,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAA;IACtD,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAA;IACnC,CAAC;IAED,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ;SACrC,IAAI,CAAC,UAAU,CAAC;SAChB,MAAM,CAAC,GAAG,CAAC;SACX,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE,CAAC;SACtB,MAAM,EAAE,CAAA;IAEX,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAA;IACtC,CAAC;IAED,MAAM,eAAe,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAA;IAEpD,OAAO,eAAe,CAAA;AACxB,CAAC;AAED,SAAS,mBAAmB,CAAC,OAA2B;IACtD,MAAM,OAAO,GAAG;QACd,CAAC,2BAAc,CAAC,cAAc,CAAC,EAAE,gBAAgB;QACjD,CAAC,2BAAc,CAAC,iBAAiB,CAAC,EAAE,mBAAmB;QACvD,CAAC,2BAAc,CAAC,qBAAqB,CAAC,EAAE,uBAAuB;QAC/D,CAAC,2BAAc,CAAC,eAAe,CAAC,EAAE,iBAAiB;QACnD,CAAC,2BAAc,CAAC,YAAY,CAAC,EAAE,cAAc;QAC7C,CAAC,2BAAc,CAAC,kBAAkB,CAAC,EAAE,oBAAoB;QACzD,CAAC,2BAAc,CAAC,oBAAoB,CAAC,EAAE,sBAAsB;QAC7D,CAAC,2BAAc,CAAC,kBAAkB,CAAC,EAAE,oBAAoB;QAEzD,CAAC,2BAAc,CAAC,sBAAsB,CAAC,EAAE,wBAAwB;QAEjE,CAAC,2BAAc,CAAC,qBAAqB,CAAC,EAAE,uBAAuB;QAC/D,CAAC,2BAAc,CAAC,uBAAuB,CAAC,EAAE,0BAA0B;QACpE,CAAC,2BAAc,CAAC,wBAAwB,CAAC,EAAE,2BAA2B;QACtE,CAAC,2BAAc,CAAC,uBAAuB,CAAC,EAAE,0BAA0B;QACpE,CAAC,2BAAc,CAAC,qBAAqB,CAAC,EAAE,4BAA4B;KACrE,CAAA;IAED,KAAK,MAAM,CAAC,MAAM,EAAE,UAAU,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;QAC3D,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;YACxB,CAAC;YAAC,OAAe,CAAC,UAAU,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;QACrD,CAAC;IACH,CAAC;IAED,OAAO,OAAO,CAAA;AAChB,CAAC;AAED,SAAgB,WAAW,CAAC,MAAqB,EAAE,OAAe;IAChE,IAAI,MAAM,KAAK,IAAI,IAAI,MAAM,KAAK,EAAE,EAAE,CAAC;QACrC,MAAM,IAAI,KAAK,CAAC,GAAG,OAAO,oBAAoB,CAAC,CAAA;IACjD,CAAC;AACH,CAAC",
      names: [],
      sources: ["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\server\\server-chat-helpers.ts"],
      sourcesContent: ["import { Database, Tables } from \"@/supabase/types\"\r\nimport { VALID_ENV_KEYS } from \"@/types/valid-keys\"\r\nimport { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function getServerProfile() {\r\n  const cookieStore = cookies()\r\n  const supabase = createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value\r\n        }\r\n      }\r\n    }\r\n  )\r\n\r\n  const user = (await supabase.auth.getUser()).data.user\r\n  if (!user) {\r\n    throw new Error(\"User not found\")\r\n  }\r\n\r\n  const { data: profile } = await supabase\r\n    .from(\"profiles\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!profile) {\r\n    throw new Error(\"Profile not found\")\r\n  }\r\n\r\n  const profileWithKeys = addApiKeysToProfile(profile)\r\n\r\n  return profileWithKeys\r\n}\r\n\r\nfunction addApiKeysToProfile(profile: Tables<\"profiles\">) {\r\n  const apiKeys = {\r\n    [VALID_ENV_KEYS.OPENAI_API_KEY]: \"openai_api_key\",\r\n    [VALID_ENV_KEYS.ANTHROPIC_API_KEY]: \"anthropic_api_key\",\r\n    [VALID_ENV_KEYS.GOOGLE_GEMINI_API_KEY]: \"google_gemini_api_key\",\r\n    [VALID_ENV_KEYS.MISTRAL_API_KEY]: \"mistral_api_key\",\r\n    [VALID_ENV_KEYS.GROQ_API_KEY]: \"groq_api_key\",\r\n    [VALID_ENV_KEYS.PERPLEXITY_API_KEY]: \"perplexity_api_key\",\r\n    [VALID_ENV_KEYS.AZURE_OPENAI_API_KEY]: \"azure_openai_api_key\",\r\n    [VALID_ENV_KEYS.OPENROUTER_API_KEY]: \"openrouter_api_key\",\r\n\r\n    [VALID_ENV_KEYS.OPENAI_ORGANIZATION_ID]: \"openai_organization_id\",\r\n\r\n    [VALID_ENV_KEYS.AZURE_OPENAI_ENDPOINT]: \"azure_openai_endpoint\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_35_TURBO_NAME]: \"azure_openai_35_turbo_id\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_45_VISION_NAME]: \"azure_openai_45_vision_id\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_45_TURBO_NAME]: \"azure_openai_45_turbo_id\",\r\n    [VALID_ENV_KEYS.AZURE_EMBEDDINGS_NAME]: \"azure_openai_embeddings_id\"\r\n  }\r\n\r\n  for (const [envKey, profileKey] of Object.entries(apiKeys)) {\r\n    if (process.env[envKey]) {\r\n      ;(profile as any)[profileKey] = process.env[envKey]\r\n    }\r\n  }\r\n\r\n  return profile\r\n}\r\n\r\nexport function checkApiKey(apiKey: string | null, keyName: string) {\r\n  if (apiKey === null || apiKey === \"\") {\r\n    throw new Error(`${keyName} API Key not found`)\r\n  }\r\n}\r\n"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "0447b505423f97498979fdccd1509302127be570"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_aie0flvqh = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_aie0flvqh();
cov_aie0flvqh().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_aie0flvqh().s[1]++;
exports.getServerProfile = getServerProfile;
/* istanbul ignore next */
cov_aie0flvqh().s[2]++;
exports.checkApiKey = checkApiKey;
const valid_keys_1 =
/* istanbul ignore next */
(cov_aie0flvqh().s[3]++, require("@/types/valid-keys"));
const ssr_1 =
/* istanbul ignore next */
(cov_aie0flvqh().s[4]++, require("@supabase/ssr"));
const headers_1 =
/* istanbul ignore next */
(cov_aie0flvqh().s[5]++, require("next/headers"));
async function getServerProfile() {
  /* istanbul ignore next */
  cov_aie0flvqh().f[0]++;
  const cookieStore =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[6]++, (0, headers_1.cookies)());
  const supabase =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[7]++, (0, ssr_1.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY, {
    cookies: {
      get(name) {
        /* istanbul ignore next */
        cov_aie0flvqh().f[1]++;
        cov_aie0flvqh().s[8]++;
        return cookieStore.get(name)?.value;
      }
    }
  }));
  const user =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[9]++, (await supabase.auth.getUser()).data.user);
  /* istanbul ignore next */
  cov_aie0flvqh().s[10]++;
  if (!user) {
    /* istanbul ignore next */
    cov_aie0flvqh().b[0][0]++;
    cov_aie0flvqh().s[11]++;
    throw new Error("User not found");
  } else
  /* istanbul ignore next */
  {
    cov_aie0flvqh().b[0][1]++;
  }
  const {
    data: profile
  } =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[12]++, await supabase.from("profiles").select("*").eq("user_id", user.id).single());
  /* istanbul ignore next */
  cov_aie0flvqh().s[13]++;
  if (!profile) {
    /* istanbul ignore next */
    cov_aie0flvqh().b[1][0]++;
    cov_aie0flvqh().s[14]++;
    throw new Error("Profile not found");
  } else
  /* istanbul ignore next */
  {
    cov_aie0flvqh().b[1][1]++;
  }
  const profileWithKeys =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[15]++, addApiKeysToProfile(profile));
  /* istanbul ignore next */
  cov_aie0flvqh().s[16]++;
  return profileWithKeys;
}
function addApiKeysToProfile(profile) {
  /* istanbul ignore next */
  cov_aie0flvqh().f[2]++;
  const apiKeys =
  /* istanbul ignore next */
  (cov_aie0flvqh().s[17]++, {
    [valid_keys_1.VALID_ENV_KEYS.OPENAI_API_KEY]: "openai_api_key",
    [valid_keys_1.VALID_ENV_KEYS.ANTHROPIC_API_KEY]: "anthropic_api_key",
    [valid_keys_1.VALID_ENV_KEYS.GOOGLE_GEMINI_API_KEY]: "google_gemini_api_key",
    [valid_keys_1.VALID_ENV_KEYS.MISTRAL_API_KEY]: "mistral_api_key",
    [valid_keys_1.VALID_ENV_KEYS.GROQ_API_KEY]: "groq_api_key",
    [valid_keys_1.VALID_ENV_KEYS.PERPLEXITY_API_KEY]: "perplexity_api_key",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_OPENAI_API_KEY]: "azure_openai_api_key",
    [valid_keys_1.VALID_ENV_KEYS.OPENROUTER_API_KEY]: "openrouter_api_key",
    [valid_keys_1.VALID_ENV_KEYS.OPENAI_ORGANIZATION_ID]: "openai_organization_id",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_OPENAI_ENDPOINT]: "azure_openai_endpoint",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_GPT_35_TURBO_NAME]: "azure_openai_35_turbo_id",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_GPT_45_VISION_NAME]: "azure_openai_45_vision_id",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_GPT_45_TURBO_NAME]: "azure_openai_45_turbo_id",
    [valid_keys_1.VALID_ENV_KEYS.AZURE_EMBEDDINGS_NAME]: "azure_openai_embeddings_id"
  });
  /* istanbul ignore next */
  cov_aie0flvqh().s[18]++;
  for (const [envKey, profileKey] of Object.entries(apiKeys)) {
    /* istanbul ignore next */
    cov_aie0flvqh().s[19]++;
    if (process.env[envKey]) {
      /* istanbul ignore next */
      cov_aie0flvqh().b[2][0]++;
      ;
      /* istanbul ignore next */
      cov_aie0flvqh().s[20]++;
      profile[profileKey] = process.env[envKey];
    } else
    /* istanbul ignore next */
    {
      cov_aie0flvqh().b[2][1]++;
    }
  }
  /* istanbul ignore next */
  cov_aie0flvqh().s[21]++;
  return profile;
}
function checkApiKey(apiKey, keyName) {
  /* istanbul ignore next */
  cov_aie0flvqh().f[3]++;
  cov_aie0flvqh().s[22]++;
  if (
  /* istanbul ignore next */
  (cov_aie0flvqh().b[4][0]++, apiKey === null) ||
  /* istanbul ignore next */
  (cov_aie0flvqh().b[4][1]++, apiKey === "")) {
    /* istanbul ignore next */
    cov_aie0flvqh().b[3][0]++;
    cov_aie0flvqh().s[23]++;
    throw new Error(`${keyName} API Key not found`);
  } else
  /* istanbul ignore next */
  {
    cov_aie0flvqh().b[3][1]++;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfYWllMGZsdnFoIiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiZXhwb3J0cyIsImdldFNlcnZlclByb2ZpbGUiLCJjaGVja0FwaUtleSIsInZhbGlkX2tleXNfMSIsInJlcXVpcmUiLCJzc3JfMSIsImhlYWRlcnNfMSIsImYiLCJjb29raWVTdG9yZSIsImNvb2tpZXMiLCJzdXBhYmFzZSIsImNyZWF0ZVNlcnZlckNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldCIsIm5hbWUiLCJ2YWx1ZSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImRhdGEiLCJiIiwiRXJyb3IiLCJwcm9maWxlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJwcm9maWxlV2l0aEtleXMiLCJhZGRBcGlLZXlzVG9Qcm9maWxlIiwiYXBpS2V5cyIsIlZBTElEX0VOVl9LRVlTIiwiT1BFTkFJX0FQSV9LRVkiLCJBTlRIUk9QSUNfQVBJX0tFWSIsIkdPT0dMRV9HRU1JTklfQVBJX0tFWSIsIk1JU1RSQUxfQVBJX0tFWSIsIkdST1FfQVBJX0tFWSIsIlBFUlBMRVhJVFlfQVBJX0tFWSIsIkFaVVJFX09QRU5BSV9BUElfS0VZIiwiT1BFTlJPVVRFUl9BUElfS0VZIiwiT1BFTkFJX09SR0FOSVpBVElPTl9JRCIsIkFaVVJFX09QRU5BSV9FTkRQT0lOVCIsIkFaVVJFX0dQVF8zNV9UVVJCT19OQU1FIiwiQVpVUkVfR1BUXzQ1X1ZJU0lPTl9OQU1FIiwiQVpVUkVfR1BUXzQ1X1RVUkJPX05BTUUiLCJBWlVSRV9FTUJFRERJTkdTX05BTUUiLCJlbnZLZXkiLCJwcm9maWxlS2V5IiwiT2JqZWN0IiwiZW50cmllcyIsImFwaUtleSIsImtleU5hbWUiXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHBlZHJvXFxEb2N1bWVudHNcXEdpdEh1YlxcQXNpc3RlbnRlLUxlZ2FsLUludGVsaWdlbnRlXFxsaWJcXHNlcnZlclxcc2VydmVyLWNoYXQtaGVscGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhYmFzZSwgVGFibGVzIH0gZnJvbSBcIkAvc3VwYWJhc2UvdHlwZXNcIlxyXG5pbXBvcnQgeyBWQUxJRF9FTlZfS0VZUyB9IGZyb20gXCJAL3R5cGVzL3ZhbGlkLWtleXNcIlxyXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3NzclwiXHJcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tIFwibmV4dC9oZWFkZXJzXCJcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXJ2ZXJQcm9maWxlKCkge1xyXG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpXHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQ8RGF0YWJhc2U+KFxyXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcclxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcclxuICAgIHtcclxuICAgICAgY29va2llczoge1xyXG4gICAgICAgIGdldChuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICAgIHJldHVybiBjb29raWVTdG9yZS5nZXQobmFtZSk/LnZhbHVlXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKVxyXG5cclxuICBjb25zdCB1c2VyID0gKGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpKS5kYXRhLnVzZXJcclxuICBpZiAoIXVzZXIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgbm90IGZvdW5kXCIpXHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShcInByb2ZpbGVzXCIpXHJcbiAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgLmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxyXG4gICAgLnNpbmdsZSgpXHJcblxyXG4gIGlmICghcHJvZmlsZSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvZmlsZSBub3QgZm91bmRcIilcclxuICB9XHJcblxyXG4gIGNvbnN0IHByb2ZpbGVXaXRoS2V5cyA9IGFkZEFwaUtleXNUb1Byb2ZpbGUocHJvZmlsZSlcclxuXHJcbiAgcmV0dXJuIHByb2ZpbGVXaXRoS2V5c1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRBcGlLZXlzVG9Qcm9maWxlKHByb2ZpbGU6IFRhYmxlczxcInByb2ZpbGVzXCI+KSB7XHJcbiAgY29uc3QgYXBpS2V5cyA9IHtcclxuICAgIFtWQUxJRF9FTlZfS0VZUy5PUEVOQUlfQVBJX0tFWV06IFwib3BlbmFpX2FwaV9rZXlcIixcclxuICAgIFtWQUxJRF9FTlZfS0VZUy5BTlRIUk9QSUNfQVBJX0tFWV06IFwiYW50aHJvcGljX2FwaV9rZXlcIixcclxuICAgIFtWQUxJRF9FTlZfS0VZUy5HT09HTEVfR0VNSU5JX0FQSV9LRVldOiBcImdvb2dsZV9nZW1pbmlfYXBpX2tleVwiLFxyXG4gICAgW1ZBTElEX0VOVl9LRVlTLk1JU1RSQUxfQVBJX0tFWV06IFwibWlzdHJhbF9hcGlfa2V5XCIsXHJcbiAgICBbVkFMSURfRU5WX0tFWVMuR1JPUV9BUElfS0VZXTogXCJncm9xX2FwaV9rZXlcIixcclxuICAgIFtWQUxJRF9FTlZfS0VZUy5QRVJQTEVYSVRZX0FQSV9LRVldOiBcInBlcnBsZXhpdHlfYXBpX2tleVwiLFxyXG4gICAgW1ZBTElEX0VOVl9LRVlTLkFaVVJFX09QRU5BSV9BUElfS0VZXTogXCJhenVyZV9vcGVuYWlfYXBpX2tleVwiLFxyXG4gICAgW1ZBTElEX0VOVl9LRVlTLk9QRU5ST1VURVJfQVBJX0tFWV06IFwib3BlbnJvdXRlcl9hcGlfa2V5XCIsXHJcblxyXG4gICAgW1ZBTElEX0VOVl9LRVlTLk9QRU5BSV9PUkdBTklaQVRJT05fSURdOiBcIm9wZW5haV9vcmdhbml6YXRpb25faWRcIixcclxuXHJcbiAgICBbVkFMSURfRU5WX0tFWVMuQVpVUkVfT1BFTkFJX0VORFBPSU5UXTogXCJhenVyZV9vcGVuYWlfZW5kcG9pbnRcIixcclxuICAgIFtWQUxJRF9FTlZfS0VZUy5BWlVSRV9HUFRfMzVfVFVSQk9fTkFNRV06IFwiYXp1cmVfb3BlbmFpXzM1X3R1cmJvX2lkXCIsXHJcbiAgICBbVkFMSURfRU5WX0tFWVMuQVpVUkVfR1BUXzQ1X1ZJU0lPTl9OQU1FXTogXCJhenVyZV9vcGVuYWlfNDVfdmlzaW9uX2lkXCIsXHJcbiAgICBbVkFMSURfRU5WX0tFWVMuQVpVUkVfR1BUXzQ1X1RVUkJPX05BTUVdOiBcImF6dXJlX29wZW5haV80NV90dXJib19pZFwiLFxyXG4gICAgW1ZBTElEX0VOVl9LRVlTLkFaVVJFX0VNQkVERElOR1NfTkFNRV06IFwiYXp1cmVfb3BlbmFpX2VtYmVkZGluZ3NfaWRcIlxyXG4gIH1cclxuXHJcbiAgZm9yIChjb25zdCBbZW52S2V5LCBwcm9maWxlS2V5XSBvZiBPYmplY3QuZW50cmllcyhhcGlLZXlzKSkge1xyXG4gICAgaWYgKHByb2Nlc3MuZW52W2VudktleV0pIHtcclxuICAgICAgOyhwcm9maWxlIGFzIGFueSlbcHJvZmlsZUtleV0gPSBwcm9jZXNzLmVudltlbnZLZXldXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcHJvZmlsZVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tBcGlLZXkoYXBpS2V5OiBzdHJpbmcgfCBudWxsLCBrZXlOYW1lOiBzdHJpbmcpIHtcclxuICBpZiAoYXBpS2V5ID09PSBudWxsIHx8IGFwaUtleSA9PT0gXCJcIikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2tleU5hbWV9IEFQSSBLZXkgbm90IGZvdW5kYClcclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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