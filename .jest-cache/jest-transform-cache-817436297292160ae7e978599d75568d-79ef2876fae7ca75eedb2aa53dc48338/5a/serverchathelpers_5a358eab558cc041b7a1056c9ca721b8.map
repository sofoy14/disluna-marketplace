{"version":3,"names":["cov_aie0flvqh","actualCoverage","s","exports","getServerProfile","checkApiKey","valid_keys_1","require","ssr_1","headers_1","f","cookieStore","cookies","supabase","createServerClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","get","name","value","user","auth","getUser","data","b","Error","profile","from","select","eq","id","single","profileWithKeys","addApiKeysToProfile","apiKeys","VALID_ENV_KEYS","OPENAI_API_KEY","ANTHROPIC_API_KEY","GOOGLE_GEMINI_API_KEY","MISTRAL_API_KEY","GROQ_API_KEY","PERPLEXITY_API_KEY","AZURE_OPENAI_API_KEY","OPENROUTER_API_KEY","OPENAI_ORGANIZATION_ID","AZURE_OPENAI_ENDPOINT","AZURE_GPT_35_TURBO_NAME","AZURE_GPT_45_VISION_NAME","AZURE_GPT_45_TURBO_NAME","AZURE_EMBEDDINGS_NAME","envKey","profileKey","Object","entries","apiKey","keyName"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\server\\server-chat-helpers.ts"],"sourcesContent":["import { Database, Tables } from \"@/supabase/types\"\r\nimport { VALID_ENV_KEYS } from \"@/types/valid-keys\"\r\nimport { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function getServerProfile() {\r\n  const cookieStore = cookies()\r\n  const supabase = createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value\r\n        }\r\n      }\r\n    }\r\n  )\r\n\r\n  const user = (await supabase.auth.getUser()).data.user\r\n  if (!user) {\r\n    throw new Error(\"User not found\")\r\n  }\r\n\r\n  const { data: profile } = await supabase\r\n    .from(\"profiles\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!profile) {\r\n    throw new Error(\"Profile not found\")\r\n  }\r\n\r\n  const profileWithKeys = addApiKeysToProfile(profile)\r\n\r\n  return profileWithKeys\r\n}\r\n\r\nfunction addApiKeysToProfile(profile: Tables<\"profiles\">) {\r\n  const apiKeys = {\r\n    [VALID_ENV_KEYS.OPENAI_API_KEY]: \"openai_api_key\",\r\n    [VALID_ENV_KEYS.ANTHROPIC_API_KEY]: \"anthropic_api_key\",\r\n    [VALID_ENV_KEYS.GOOGLE_GEMINI_API_KEY]: \"google_gemini_api_key\",\r\n    [VALID_ENV_KEYS.MISTRAL_API_KEY]: \"mistral_api_key\",\r\n    [VALID_ENV_KEYS.GROQ_API_KEY]: \"groq_api_key\",\r\n    [VALID_ENV_KEYS.PERPLEXITY_API_KEY]: \"perplexity_api_key\",\r\n    [VALID_ENV_KEYS.AZURE_OPENAI_API_KEY]: \"azure_openai_api_key\",\r\n    [VALID_ENV_KEYS.OPENROUTER_API_KEY]: \"openrouter_api_key\",\r\n\r\n    [VALID_ENV_KEYS.OPENAI_ORGANIZATION_ID]: \"openai_organization_id\",\r\n\r\n    [VALID_ENV_KEYS.AZURE_OPENAI_ENDPOINT]: \"azure_openai_endpoint\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_35_TURBO_NAME]: \"azure_openai_35_turbo_id\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_45_VISION_NAME]: \"azure_openai_45_vision_id\",\r\n    [VALID_ENV_KEYS.AZURE_GPT_45_TURBO_NAME]: \"azure_openai_45_turbo_id\",\r\n    [VALID_ENV_KEYS.AZURE_EMBEDDINGS_NAME]: \"azure_openai_embeddings_id\"\r\n  }\r\n\r\n  for (const [envKey, profileKey] of Object.entries(apiKeys)) {\r\n    if (process.env[envKey]) {\r\n      ;(profile as any)[profileKey] = process.env[envKey]\r\n    }\r\n  }\r\n\r\n  return profile\r\n}\r\n\r\nexport function checkApiKey(apiKey: string | null, keyName: string) {\r\n  if (apiKey === null || apiKey === \"\") {\r\n    throw new Error(`${keyName} API Key not found`)\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}