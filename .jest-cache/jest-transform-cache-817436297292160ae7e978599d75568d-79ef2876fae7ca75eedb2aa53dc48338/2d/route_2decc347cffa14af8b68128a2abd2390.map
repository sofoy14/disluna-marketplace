{"version":3,"names":["cov_2jt6mvqk0b","actualCoverage","s","exports","POST","tongyi_unified_legal_agent_1","require","chat_memory_manager_1","DEFAULT_MAX_TOKENS","DEFAULT_TEMPERATURE","request","f","chatSettings","messages","chatId","userId","json","apiKey","b","process","env","OPENROUTER_API_KEY","Error","userQuery","extractLastUserMessage","modelName","model","finalChatId","Date","now","Math","random","toString","substr","finalUserId","console","log","repeat","memoryManager","ChatMemoryManager","getInstance","chatContext","getChatContext","relevantHistory","getRelevantHistory","length","currentContext","requiresSearch","detectSearchRequirement","responseContent","unifiedAgent","createTongyiUnifiedLegalAgent","maxRounds","enableContinuousVerification","enableIterativeRefinement","enableMemory","enableAntiHallucination","preferredSources","qualityThreshold","unifiedResponse","processLegalQuery","analysis","researchMode","metadata","totalRounds","totalSources","verificationPassed","confidence","toFixed","processingTime","finalAnswer","searchError","error","userMessageId","saveMessage","stream","ReadableStream","start","controller","chunks","split","index","pushChunk","chunk","enqueue","TextEncoder","encode","setTimeout","close","assistantMessageId","searchRounds","totalSearches","totalResults","finalQuality","modelDecisions","searchStrategy","Response","headers","message","status","JSON","stringify","runtime","lastUserMessage","reverse","find","m","role","content","query","searchKeywords","lowerQuery","toLowerCase","hasLegalKeyword","some","keyword","includes","isComplexQuery","hasMultipleQuestions","match"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\chat\\legal\\route.ts"],"sourcesContent":["import { ChatSettings } from \"@/types\"\nimport { NextRequest, NextResponse } from \"next/server\"\nimport { createTongyiUnifiedLegalAgent } from \"@/lib/agents/tongyi-unified-legal-agent\"\nimport { ChatMemoryManager } from \"@/lib/memory/chat-memory-manager\"\n\nconst DEFAULT_MAX_TOKENS = 4000\nconst DEFAULT_TEMPERATURE = 0.3\n\ninterface RequestBody {\n  chatSettings: ChatSettings\n  messages: Array<{ role: \"system\" | \"user\" | \"assistant\"; content: string }>\n  chatId?: string\n  userId?: string\n}\n\nexport async function POST(request: Request) {\n  const { chatSettings, messages, chatId, userId } = (await request.json()) as RequestBody\n\n  try {\n    const apiKey = process.env.OPENROUTER_API_KEY || \"\"\n\n    if (!apiKey) {\n      throw new Error(\n        \"OpenRouter API Key no configurada. Define OPENROUTER_API_KEY.\"\n      )\n    }\n\n    const userQuery = extractLastUserMessage(messages)\n    const modelName = chatSettings.model as string\n    \n    // Generar IDs Ãºnicos para el chat si no se proporcionan\n    const finalChatId = chatId || `chat-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n    const finalUserId = userId || \"usuario-anonimo\"\n\n    console.log(`\\nðŸ§  TONGYI REACT AGENT - SISTEMA COMPLETO`)\n    console.log(`ðŸ“ Query: \"${userQuery}\"`)\n    console.log(`ðŸ’¬ Chat ID: ${finalChatId}`)\n    console.log(`ðŸ‘¤ User ID: ${finalUserId}`)\n    console.log(`ðŸ¤– Modelo: ${modelName}`)\n    console.log(`${'='.repeat(80)}`)\n\n    // Inicializar sistema de memoria\n    const memoryManager = ChatMemoryManager.getInstance()\n    const chatContext = await memoryManager.getChatContext(finalChatId, finalUserId)\n    \n    // Obtener historial relevante\n    const relevantHistory = await memoryManager.getRelevantHistory(\n      finalChatId, \n      finalUserId, \n      userQuery, \n      10\n    )\n\n    console.log(`ðŸ§  Memoria cargada: ${relevantHistory.length} mensajes relevantes`)\n    console.log(`ðŸ“Š Contexto actual: ${chatContext.currentContext.length} caracteres`)\n\n    // Detectar si la consulta requiere bÃºsqueda web\n    const requiresSearch = detectSearchRequirement(userQuery)\n    \n    let responseContent = \"\"\n\n    if (requiresSearch) {\n      console.log(`ðŸ” Consulta requiere bÃºsqueda web - Ejecutando Agente Unificado`)\n      \n      try {\n        // Usar agente Tongyi Unificado con paradigmas oficiales de DeepResearch\n        const unifiedAgent = createTongyiUnifiedLegalAgent(apiKey, {\n          maxRounds: 8,\n          enableContinuousVerification: true,\n          enableIterativeRefinement: true,\n          enableMemory: true,\n          enableAntiHallucination: true,\n          preferredSources: ['official', 'academic', 'news'],\n          qualityThreshold: 0.85\n        })\n        \n        const unifiedResponse = await unifiedAgent.processLegalQuery(\n          userQuery,\n          finalChatId,\n          finalUserId\n        )\n\n        console.log(`âœ… Agente Unificado completado:`)\n        console.log(`   ðŸŽ¯ Modo de investigaciÃ³n: ${unifiedResponse.analysis.researchMode}`)\n        console.log(`   ðŸ” Rondas ejecutadas: ${unifiedResponse.metadata.totalRounds}`)\n        console.log(`   ðŸ“„ Fuentes encontradas: ${unifiedResponse.metadata.totalSources}`)\n        console.log(`   ðŸ›¡ï¸ VerificaciÃ³n: ${unifiedResponse.analysis.verificationPassed ? 'âœ…' : 'âŒ'}`)\n        console.log(`   ðŸŽ¯ Confianza: ${unifiedResponse.analysis.confidence.toFixed(2)}`)\n        console.log(`   â±ï¸ Tiempo: ${(unifiedResponse.analysis.processingTime / 1000).toFixed(1)}s`)\n\n                // Usar directamente la respuesta del modelo sin agregar informaciÃ³n adicional\n                responseContent = unifiedResponse.finalAnswer\n\n      } catch (searchError) {\n        console.error(`âŒ Error en agente unificado:`, searchError)\n        \n        // Fallback a respuesta simple\n        console.log(`ðŸ”„ Fallback a respuesta directa`)\n        responseContent = `Disculpe, hubo un error procesando su consulta con el sistema de anÃ¡lisis avanzado. Por favor, intente reformular su pregunta de manera mÃ¡s especÃ­fica.`\n      }\n    } else {\n      console.log(`ðŸ’¬ Consulta simple - Respondiendo directamente`)\n      responseContent = `Esta consulta no requiere bÃºsqueda web especÃ­fica. Por favor, proporcione mÃ¡s detalles sobre su consulta legal para obtener una respuesta mÃ¡s completa.`\n    }\n    \n    // Guardar mensaje del usuario en memoria\n    const userMessageId = `user-${Date.now()}`\n    await memoryManager.saveMessage(\n      finalChatId,\n      finalUserId,\n      userMessageId,\n      userQuery,\n      'user'\n    )\n\n    // Crear stream personalizado para la respuesta del agente unificado\n    const stream = new ReadableStream({\n      start(controller) {\n        const chunks = responseContent.split(' ')\n        let index = 0\n        \n        const pushChunk = () => {\n          if (index < chunks.length) {\n            const chunk = chunks[index] + (index < chunks.length - 1 ? ' ' : '')\n            controller.enqueue(new TextEncoder().encode(chunk))\n            index++\n            setTimeout(pushChunk, 30) // Simular streaming mÃ¡s rÃ¡pido\n          } else {\n            controller.close()\n          }\n        }\n        \n        pushChunk()\n      }\n    })\n\n    // Guardar respuesta del asistente en memoria\n    const assistantMessageId = `assistant-${Date.now()}`\n    await memoryManager.saveMessage(\n      finalChatId,\n      finalUserId,\n      assistantMessageId,\n      responseContent,\n      'assistant',\n      {\n        searchRounds: requiresSearch ? 8 : 0,\n        totalSearches: requiresSearch ? 1 : 0,\n        totalResults: requiresSearch ? 1 : 0,\n        finalQuality: 9,\n        modelDecisions: requiresSearch ? 1 : 0,\n        searchStrategy: requiresSearch ? \"AGENTE_UNIFICADO_TONGYI\" : \"RESPUESTA_DIRECTA\"\n      }\n    )\n    \n    console.log(`ðŸ’¾ Respuesta del agente unificado guardada en memoria: ${responseContent.length} caracteres`)\n    \n    return new Response(stream, {\n      headers: {\n        'Content-Type': 'text/plain; charset=utf-8',\n        'Transfer-Encoding': 'chunked',\n      },\n    })\n\n  } catch (error: any) {\n    console.error(\"[legal-route] Error:\", error)\n    const message =\n      error?.error?.message ||\n      error?.message ||\n      \"Error en el asistente legal colombiano\"\n\n    const status = typeof error?.status === \"number\" ? error.status : 500\n\n    return new Response(\n      JSON.stringify({\n        message,\n        error: \"ASISTENTE_LEGAL_ERROR\",\n      }),\n      { status }\n    )\n  }\n}\n\nexport const runtime = \"edge\"\n\nfunction extractLastUserMessage(messages: RequestBody[\"messages\"]): string {\n  const lastUserMessage = [...messages].reverse().find((m) => m.role === \"user\")\n  return typeof lastUserMessage?.content === \"string\"\n    ? lastUserMessage.content\n    : \"\"\n}\n\nfunction detectSearchRequirement(query: string): boolean {\n  const searchKeywords = [\n    'requisitos', 'constituir', 'sociedad', 'SAS', 'SRL', 'SA',\n    'jurisprudencia', 'corte', 'constitucional', 'consejo', 'estado',\n    'cÃ³digo', 'ley', 'decreto', 'artÃ­culo', 'norma', 'legislaciÃ³n',\n    'reforma', 'modificaciÃ³n', 'vigencia', 'derogaciÃ³n',\n    'proceso', 'trÃ¡mite', 'procedimiento', 'requisito',\n    'documento', 'certificado', 'registro', 'matrÃ­cula',\n    'colombia', 'colombiano', 'derecho', 'legal', 'jurÃ­dico',\n    'contrato', 'obligaciÃ³n', 'responsabilidad', 'daÃ±o',\n    'penal', 'civil', 'comercial', 'laboral', 'administrativo',\n    'tributario', 'fiscal', 'impuesto', 'DIAN', 'superintendencia',\n    'ministerio', 'gobierno', 'estado', 'municipio', 'departamento',\n    'valor financiero', 'cuentas', 'participaciÃ³n', 'financiero',\n    'bancario', 'crÃ©dito', 'prÃ©stamo', 'inversiÃ³n', 'capital'\n  ]\n  \n  const lowerQuery = query.toLowerCase()\n  \n  // Ser mÃ¡s agresivo: si contiene cualquier palabra legal, buscar\n  const hasLegalKeyword = searchKeywords.some(keyword => lowerQuery.includes(keyword))\n  \n  // TambiÃ©n buscar si la consulta es larga (probablemente compleja)\n  const isComplexQuery = query.length > 30\n  \n  // Buscar si contiene signos de interrogaciÃ³n mÃºltiples o puntos\n  const hasMultipleQuestions = (query.match(/\\?/g) || []).length > 0\n  \n  return hasLegalKeyword || isComplexQuery || hasMultipleQuestions\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}