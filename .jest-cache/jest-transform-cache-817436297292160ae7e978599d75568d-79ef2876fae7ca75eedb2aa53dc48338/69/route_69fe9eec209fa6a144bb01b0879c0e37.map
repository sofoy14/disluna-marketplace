{"version":3,"names":["cov_26akibynp3","actualCoverage","exports","POST","ai_1","s","require","openai_1","__importDefault","unlimited_search_orchestrator_1","chat_memory_manager_1","OPENROUTER_BASE_URL","DEFAULT_MAX_TOKENS","DEFAULT_TEMPERATURE","request","f","chatSettings","messages","chatId","userId","json","apiKey","b","process","env","OPENROUTER_API_KEY","Error","client","default","baseURL","userQuery","extractLastUserMessage","modelName","model","finalChatId","Date","now","Math","random","toString","substr","finalUserId","console","log","repeat","memoryManager","ChatMemoryManager","getInstance","chatContext","getChatContext","relevantHistory","getRelevantHistory","length","currentContext","requiresSearch","detectSearchRequirement","systemContent","memoryContext","buildMemoryContext","compatibleModel","includes","searchResult","runUnlimitedSearchWorkflow","searchTimeoutMs","maxResultsPerSearch","enableContentExtraction","totalSearches","totalResults","totalDurationMs","toFixed","recordSearch","allResults","finalContext","searchError","error","userMessageId","saveMessage","systemMessage","role","content","messagesWithSystem","finalModel","response","chat","completions","create","temperature","max_tokens","stream","fullResponse","OpenAIStream","onToken","token","onFinish","assistantMessageId","searchRounds","finalQuality","modelDecisions","searchStrategy","StreamingTextResponse","message","status","Response","JSON","stringify","runtime","lastUserMessage","reverse","find","m","query","searchKeywords","lowerQuery","toLowerCase","hasLegalKeyword","some","keyword","isComplexQuery","hasMultipleQuestions","match","hasSearchIntent","history","contextMessages","slice","map","msg","substring","join"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\chat\\free-navigation\\route.ts"],"sourcesContent":["import { ChatSettings } from \"@/types\"\r\nimport { OpenAIStream, StreamingTextResponse } from \"ai\"\r\nimport OpenAI from \"openai\"\r\nimport { ChatCompletionCreateParamsBase } from \"openai/resources/chat/completions.mjs\"\r\nimport { runUnlimitedSearchWorkflow } from \"@/lib/tools/unlimited-search-orchestrator\"\r\nimport { ChatMemoryManager } from \"@/lib/memory/chat-memory-manager\"\r\n\r\nconst OPENROUTER_BASE_URL = \"https://openrouter.ai/api/v1\"\r\nconst DEFAULT_MAX_TOKENS = 4000\r\nconst DEFAULT_TEMPERATURE = 0.3\r\n\r\ninterface RequestBody {\r\n  chatSettings: ChatSettings\r\n  messages: Array<{ role: \"system\" | \"user\" | \"assistant\"; content: string }>\r\n  chatId?: string\r\n  userId?: string\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const { chatSettings, messages, chatId, userId } = (await request.json()) as RequestBody\r\n\r\n  try {\r\n    const apiKey = process.env.OPENROUTER_API_KEY || \"\"\r\n\r\n    if (!apiKey) {\r\n      throw new Error(\r\n        \"OpenRouter API Key no configurada. Define OPENROUTER_API_KEY.\"\r\n      )\r\n    }\r\n\r\n    const client = new OpenAI({\r\n      apiKey,\r\n      baseURL: OPENROUTER_BASE_URL,\r\n    })\r\n\r\n    const userQuery = extractLastUserMessage(messages)\r\n    const modelName = chatSettings.model as string\r\n    \r\n    // Generar IDs Ãºnicos para el chat si no se proporcionan\r\n    const finalChatId = chatId || `chat-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n    const finalUserId = userId || \"usuario-anonimo\"\r\n\r\n    console.log(`\\nðŸŒ NAVEGACIÃ“N LIBRE EN LA WEB INICIADA`)\r\n    console.log(`ðŸ“ Query: \"${userQuery}\"`)\r\n    console.log(`ðŸ’¬ Chat ID: ${finalChatId}`)\r\n    console.log(`ðŸ‘¤ User ID: ${finalUserId}`)\r\n    console.log(`ðŸ¤– Modelo: ${modelName}`)\r\n    console.log(`${'='.repeat(80)}`)\r\n\r\n    // Inicializar sistema de memoria\r\n    const memoryManager = ChatMemoryManager.getInstance()\r\n    const chatContext = await memoryManager.getChatContext(finalChatId, finalUserId)\r\n    \r\n    // Obtener historial relevante\r\n    const relevantHistory = await memoryManager.getRelevantHistory(\r\n      finalChatId, \r\n      finalUserId, \r\n      userQuery, \r\n      10\r\n    )\r\n\r\n    console.log(`ðŸ§  Memoria cargada: ${relevantHistory.length} mensajes relevantes`)\r\n    console.log(`ðŸ“Š Contexto actual: ${chatContext.currentContext.length} caracteres`)\r\n\r\n    // Detectar si la consulta requiere bÃºsqueda web\r\n    const requiresSearch = detectSearchRequirement(userQuery)\r\n    \r\n    let systemContent = `Eres un asistente legal experto en derecho colombiano con acceso completo a la web. Responde de manera completa y precisa usando terminologÃ­a jurÃ­dica apropiada.`\r\n    \r\n    // Agregar contexto de memoria si existe\r\n    if (relevantHistory.length > 0) {\r\n      const memoryContext = buildMemoryContext(relevantHistory)\r\n      systemContent += `\\n\\nCONTEXTO DE CONVERSACIÃ“N ANTERIOR:\\n${memoryContext}`\r\n    }\r\n    \r\n    if (requiresSearch) {\r\n      console.log(`ðŸ” Consulta requiere bÃºsqueda web - Ejecutando navegaciÃ³n libre`)\r\n      \r\n      try {\r\n        // Usar sistema de bÃºsqueda completamente libre\r\n        const compatibleModel = modelName.includes('tongyi') ? 'alibaba/tongyi-deepresearch-30b-a3b' : modelName\r\n        const searchResult = await runUnlimitedSearchWorkflow(userQuery, {\r\n          client,\r\n          model: compatibleModel,\r\n          searchTimeoutMs: 30000,\r\n          maxResultsPerSearch: 10,\r\n          enableContentExtraction: true\r\n        })\r\n\r\n        console.log(`âœ… NavegaciÃ³n libre completada:`)\r\n        console.log(`   ðŸ” BÃºsquedas: ${searchResult.totalSearches}`)\r\n        console.log(`   ðŸ“„ Resultados: ${searchResult.totalResults}`)\r\n        console.log(`   â±ï¸ DuraciÃ³n: ${(searchResult.totalDurationMs / 1000).toFixed(1)}s`)\r\n\r\n        // Guardar informaciÃ³n de bÃºsqueda en memoria\r\n        await memoryManager.recordSearch(\r\n          finalChatId,\r\n          finalUserId,\r\n          userQuery,\r\n          searchResult.allResults,\r\n          searchResult.totalSearches,\r\n          searchResult.totalDurationMs\r\n        )\r\n\r\n        systemContent = `Eres un asistente legal experto en derecho colombiano con acceso completo a la web. Utiliza EXCLUSIVAMENTE la informaciÃ³n proporcionada para responder la consulta del usuario.\r\n\r\n${searchResult.finalContext}\r\n\r\nINSTRUCCIONES:\r\n1. Responde de manera completa y precisa\r\n2. Usa terminologÃ­a jurÃ­dica apropiada\r\n3. Incluye referencias a artÃ­culos y leyes cuando sea relevante\r\n4. Proporciona informaciÃ³n prÃ¡ctica y aplicable\r\n5. Si hay informaciÃ³n insuficiente, indÃ­calo claramente\r\n6. Responde en espaÃ±ol colombiano\r\n7. Considera el contexto de conversaciÃ³n anterior si es relevante`\r\n\r\n      } catch (searchError) {\r\n        console.error(`âŒ Error en navegaciÃ³n libre:`, searchError)\r\n        systemContent = `Eres un asistente legal experto en derecho colombiano. Responde de manera completa y precisa usando terminologÃ­a jurÃ­dica apropiada.`\r\n      }\r\n    } else {\r\n      console.log(`ðŸ’¬ Consulta simple - Respondiendo directamente`)\r\n    }\r\n    \r\n    // Guardar mensaje del usuario en memoria\r\n    const userMessageId = `user-${Date.now()}`\r\n    await memoryManager.saveMessage(\r\n      finalChatId,\r\n      finalUserId,\r\n      userMessageId,\r\n      userQuery,\r\n      'user'\r\n    )\r\n    \r\n    // Agregar mensaje de sistema\r\n    const systemMessage = {\r\n      role: \"system\" as const,\r\n      content: systemContent\r\n    }\r\n    \r\n    const messagesWithSystem = [systemMessage, ...messages]\r\n\r\n    // Generar respuesta streaming con modelo compatible\r\n    const finalModel = modelName.includes('tongyi') ? 'alibaba/tongyi-deepresearch-30b-a3b' : chatSettings.model\r\n    const response = await client.chat.completions.create({\r\n      model: finalModel as ChatCompletionCreateParamsBase[\"model\"],\r\n      messages: messagesWithSystem,\r\n      temperature:\r\n        typeof chatSettings.temperature === \"number\"\r\n          ? chatSettings.temperature\r\n          : DEFAULT_TEMPERATURE,\r\n      max_tokens: DEFAULT_MAX_TOKENS,\r\n      stream: true,\r\n    })\r\n\r\n    // Crear stream personalizado para capturar la respuesta completa\r\n    let fullResponse = \"\"\r\n    const stream = OpenAIStream(response, {\r\n      onToken: (token) => {\r\n        fullResponse += token\r\n      },\r\n      onFinish: async () => {\r\n        // Guardar respuesta del asistente en memoria\r\n        const assistantMessageId = `assistant-${Date.now()}`\r\n        await memoryManager.saveMessage(\r\n          finalChatId,\r\n          finalUserId,\r\n          assistantMessageId,\r\n          fullResponse,\r\n          'assistant',\r\n          {\r\n            searchRounds: requiresSearch ? 1 : 0,\r\n            totalSearches: requiresSearch ? 1 : 0,\r\n            totalResults: requiresSearch ? 1 : 0,\r\n            finalQuality: 8,\r\n            modelDecisions: 0,\r\n            searchStrategy: requiresSearch ? \"NAVEGACION_LIBRE\" : \"RESPUESTA_DIRECTA\"\r\n          }\r\n        )\r\n        \r\n        console.log(`ðŸ’¾ Respuesta guardada en memoria: ${fullResponse.length} caracteres`)\r\n      }\r\n    })\r\n\r\n    return new StreamingTextResponse(stream)\r\n\r\n  } catch (error: any) {\r\n    console.error(\"[free-navigation-route] Error:\", error)\r\n    const message =\r\n      error?.error?.message ||\r\n      error?.message ||\r\n      \"Error en el asistente legal con navegaciÃ³n libre\"\r\n\r\n    const status = typeof error?.status === \"number\" ? error.status : 500\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        message,\r\n        error: \"FREE_NAVIGATION_ERROR\",\r\n      }),\r\n      { status }\r\n    )\r\n  }\r\n}\r\n\r\nexport const runtime = \"edge\"\r\n\r\nfunction extractLastUserMessage(messages: RequestBody[\"messages\"]): string {\r\n  const lastUserMessage = [...messages].reverse().find((m) => m.role === \"user\")\r\n  return typeof lastUserMessage?.content === \"string\"\r\n    ? lastUserMessage.content\r\n    : \"\"\r\n}\r\n\r\nfunction detectSearchRequirement(query: string): boolean {\r\n  const searchKeywords = [\r\n    'requisitos', 'constituir', 'sociedad', 'SAS', 'SRL', 'SA',\r\n    'jurisprudencia', 'corte', 'constitucional', 'consejo', 'estado',\r\n    'cÃ³digo', 'ley', 'decreto', 'artÃ­culo', 'norma', 'legislaciÃ³n',\r\n    'reforma', 'modificaciÃ³n', 'vigencia', 'derogaciÃ³n',\r\n    'proceso', 'trÃ¡mite', 'procedimiento', 'requisito',\r\n    'documento', 'certificado', 'registro', 'matrÃ­cula',\r\n    'colombia', 'colombiano', 'derecho', 'legal', 'jurÃ­dico',\r\n    'contrato', 'obligaciÃ³n', 'responsabilidad', 'daÃ±o',\r\n    'penal', 'civil', 'comercial', 'laboral', 'administrativo',\r\n    'tributario', 'fiscal', 'impuesto', 'DIAN', 'superintendencia',\r\n    'ministerio', 'gobierno', 'estado', 'municipio', 'departamento',\r\n    'buscar', 'investigar', 'encontrar', 'informaciÃ³n', 'datos',\r\n    'actualizado', 'reciente', 'nuevo', 'Ãºltimo', 'vigente'\r\n  ]\r\n  \r\n  const lowerQuery = query.toLowerCase()\r\n  \r\n  // Ser mÃ¡s agresivo: si contiene cualquier palabra legal, buscar\r\n  const hasLegalKeyword = searchKeywords.some(keyword => lowerQuery.includes(keyword))\r\n  \r\n  // TambiÃ©n buscar si la consulta es larga (probablemente compleja)\r\n  const isComplexQuery = query.length > 30\r\n  \r\n  // Buscar si contiene signos de interrogaciÃ³n mÃºltiples o puntos\r\n  const hasMultipleQuestions = (query.match(/\\?/g) || []).length > 0\r\n  \r\n  // Buscar si menciona \"buscar\", \"investigar\", etc.\r\n  const hasSearchIntent = lowerQuery.includes('buscar') || \r\n                         lowerQuery.includes('investigar') || \r\n                         lowerQuery.includes('encontrar') ||\r\n                         lowerQuery.includes('informaciÃ³n')\r\n  \r\n  return hasLegalKeyword || isComplexQuery || hasMultipleQuestions || hasSearchIntent\r\n}\r\n\r\nfunction buildMemoryContext(history: any[]): string {\r\n  if (history.length === 0) return \"\"\r\n  \r\n  const contextMessages = history.slice(-5).map(msg => {\r\n    const role = msg.role === 'user' ? 'Usuario' : 'Asistente'\r\n    const content = msg.content.length > 200 ? msg.content.substring(0, 200) + '...' : msg.content\r\n    return `${role}: ${content}`\r\n  }).join('\\n\\n')\r\n  \r\n  return `CONVERSACIÃ“N ANTERIOR:\\n${contextMessages}\\n\\nUsa este contexto para mantener coherencia en la conversaciÃ³n.`\r\n}\r\n\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}