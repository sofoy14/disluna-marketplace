{"version":3,"names":["cov_c7f45xavz","actualCoverage","s","exports","extractContentEnhanced","extractMultipleContentEnhanced","checkExtractionServices","web_search_1","require","firecrawl_extraction_only_1","url","f","console","log","fireCrawlResult","fireCrawlExtractionClient","extractContent","b","success","content","length","title","description","extractionMethod","error","jinaContent","extractUrlContent","urls","results","Map","batchSize","i","batch","slice","batchPromises","map","result","batchResults","Promise","all","forEach","set","resolve","setTimeout","successfulExtractions","Array","from","values","filter","r","firecrawlAvailable","jinaAvailable","isAvailable","testJinaAvailability","firecrawl","jina"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\tools\\enhanced-content-extraction.ts"],"sourcesContent":["import { extractUrlContent } from \"@/lib/tools/web-search\"\r\nimport { fireCrawlExtractionClient, FireCrawlExtractionResult } from \"@/lib/tools/firecrawl-extraction-only\"\r\n\r\nexport interface EnhancedContentExtraction {\r\n  content: string\r\n  title: string\r\n  description: string\r\n  extractionMethod: 'firecrawl' | 'jina-ai' | 'fallback'\r\n  success: boolean\r\n  error?: string\r\n}\r\n\r\n/**\r\n * Extrae contenido de una URL usando FireCrawl como primera opci√≥n y Jina AI como fallback\r\n */\r\nexport async function extractContentEnhanced(url: string): Promise<EnhancedContentExtraction> {\r\n  console.log(`üîç Extracci√≥n mejorada de contenido: ${url}`)\r\n  \r\n  try {\r\n    // PRIMERA OPCI√ìN: FireCrawl para extracci√≥n de alta calidad\r\n    const fireCrawlResult = await fireCrawlExtractionClient.extractContent(url)\r\n    \r\n    if (fireCrawlResult.success && fireCrawlResult.content && fireCrawlResult.content.length > 100) {\r\n      console.log(`‚úÖ FireCrawl exitoso: ${fireCrawlResult.content.length} caracteres`)\r\n      \r\n      return {\r\n        content: fireCrawlResult.content,\r\n        title: fireCrawlResult.title || '',\r\n        description: fireCrawlResult.description || '',\r\n        extractionMethod: 'firecrawl',\r\n        success: true\r\n      }\r\n    }\r\n    \r\n    console.log(`‚ö†Ô∏è FireCrawl fall√≥ o contenido insuficiente, probando Jina AI`)\r\n    \r\n  } catch (error) {\r\n    console.log(`‚ö†Ô∏è Error en FireCrawl: ${error}, probando Jina AI`)\r\n  }\r\n  \r\n  try {\r\n    // SEGUNDA OPCI√ìN: Jina AI como fallback\r\n    const jinaContent = await extractUrlContent(url)\r\n    \r\n    if (jinaContent && jinaContent.length > 100) {\r\n      console.log(`‚úÖ Jina AI exitoso: ${jinaContent.length} caracteres`)\r\n      \r\n      return {\r\n        content: jinaContent,\r\n        title: '',\r\n        description: '',\r\n        extractionMethod: 'jina-ai',\r\n        success: true\r\n      }\r\n    }\r\n    \r\n    console.log(`‚ö†Ô∏è Jina AI fall√≥ o contenido insuficiente`)\r\n    \r\n  } catch (error) {\r\n    console.log(`‚ö†Ô∏è Error en Jina AI: ${error}`)\r\n  }\r\n  \r\n  // FALLBACK: Respuesta b√°sica\r\n  console.log(`‚ùå Ambas extracciones fallaron`)\r\n  \r\n  return {\r\n    content: '',\r\n    title: '',\r\n    description: '',\r\n    extractionMethod: 'fallback',\r\n    success: false,\r\n    error: 'No se pudo extraer contenido de la URL'\r\n  }\r\n}\r\n\r\n/**\r\n * Extrae contenido de m√∫ltiples URLs usando FireCrawl + Jina AI\r\n */\r\nexport async function extractMultipleContentEnhanced(urls: string[]): Promise<Map<string, EnhancedContentExtraction>> {\r\n  console.log(`üîç Extracci√≥n mejorada m√∫ltiple: ${urls.length} URLs`)\r\n  \r\n  const results = new Map<string, EnhancedContentExtraction>()\r\n  \r\n  // Procesar URLs en paralelo (m√°ximo 5 a la vez)\r\n  const batchSize = 5\r\n  for (let i = 0; i < urls.length; i += batchSize) {\r\n    const batch = urls.slice(i, i + batchSize)\r\n    \r\n    const batchPromises = batch.map(async (url) => {\r\n      const result = await extractContentEnhanced(url)\r\n      return { url, result }\r\n    })\r\n    \r\n    const batchResults = await Promise.all(batchPromises)\r\n    \r\n    batchResults.forEach(({ url, result }) => {\r\n      results.set(url, result)\r\n    })\r\n    \r\n    // Pausa entre lotes para evitar rate limiting\r\n    if (i + batchSize < urls.length) {\r\n      await new Promise(resolve => setTimeout(resolve, 2000))\r\n    }\r\n  }\r\n  \r\n  const successfulExtractions = Array.from(results.values()).filter(r => r.success).length\r\n  console.log(`‚úÖ Extracci√≥n m√∫ltiple completada: ${successfulExtractions}/${urls.length} exitosas`)\r\n  \r\n  return results\r\n}\r\n\r\n/**\r\n * Verifica la disponibilidad de los servicios de extracci√≥n\r\n */\r\nexport async function checkExtractionServices(): Promise<{\r\n  firecrawl: boolean\r\n  jina: boolean\r\n}> {\r\n  console.log(`üîç Verificando servicios de extracci√≥n`)\r\n  \r\n  const [firecrawlAvailable, jinaAvailable] = await Promise.all([\r\n    fireCrawlExtractionClient.isAvailable(),\r\n    testJinaAvailability()\r\n  ])\r\n  \r\n  console.log(`üìä Servicios disponibles:`)\r\n  console.log(`   üî• FireCrawl: ${firecrawlAvailable ? '‚úÖ' : '‚ùå'}`)\r\n  console.log(`   ü§ñ Jina AI: ${jinaAvailable ? '‚úÖ' : '‚ùå'}`)\r\n  \r\n  return {\r\n    firecrawl: firecrawlAvailable,\r\n    jina: jinaAvailable\r\n  }\r\n}\r\n\r\n/**\r\n * Prueba la disponibilidad de Jina AI\r\n */\r\nasync function testJinaAvailability(): Promise<boolean> {\r\n  try {\r\n    await extractUrlContent('https://example.com')\r\n    return true\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]}