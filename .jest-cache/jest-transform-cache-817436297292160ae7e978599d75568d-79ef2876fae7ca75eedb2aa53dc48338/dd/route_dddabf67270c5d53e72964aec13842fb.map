{"version":3,"names":["cov_16t0xfhf7j","actualCoverage","s","exports","POST","supabase_js_1","require","runtime","request","f","json","username","supabaseAdmin","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","data","usernames","error","from","select","eq","b","Error","message","Response","JSON","stringify","isAvailable","length","status","errorMessage","errorCode"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\username\\available\\route.ts"],"sourcesContent":["import { Database } from \"@/supabase/types\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\n\r\nexport const runtime = \"edge\"\r\n\r\nexport async function POST(request: Request) {\r\n  const json = await request.json()\r\n  const { username } = json as {\r\n    username: string\r\n  }\r\n\r\n  try {\r\n    const supabaseAdmin = createClient<Database>(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n    )\r\n\r\n    const { data: usernames, error } = await supabaseAdmin\r\n      .from(\"profiles\")\r\n      .select(\"username\")\r\n      .eq(\"username\", username)\r\n\r\n    if (!usernames) {\r\n      throw new Error(error.message)\r\n    }\r\n\r\n    return new Response(JSON.stringify({ isAvailable: !usernames.length }), {\r\n      status: 200\r\n    })\r\n  } catch (error: any) {\r\n    const errorMessage = error.error?.message || \"An unexpected error occurred\"\r\n    const errorCode = error.status || 500\r\n    return new Response(JSON.stringify({ message: errorMessage }), {\r\n      status: errorCode\r\n    })\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}