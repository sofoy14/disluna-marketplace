9647bd2d72e6148121cbf3fe1f8b93e2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const model_answer_1 = require("../../../lib/parsers/model-answer");
const sampleContent = `
Planteamiento del problema jurídico

El Ministerio Público consulta sobre la aplicación de la Ley 1437 de 2011.

## Bibliografía
- [Ley 1437 de 2011](https://www.suin.gov.co/lei-1437-2011)
- Sentencia T-123 de 2018 — Corte Constitucional (https://www.corteconstitucional.gov.co/T-123-18)
`;
describe("parseModelAnswer", () => {
    it("separates bibliography section and normalizes citations", () => {
        const result = (0, model_answer_1.parseModelAnswer)(sampleContent);
        expect(result.text).toContain("Planteamiento del problema jurídico");
        expect(result.text).not.toContain("Bibliografía");
        expect(result.citations).toBeDefined();
        expect(result.citations?.length).toBe(2);
        expect(result.citations?.[0].title).toBe("Ley 1437 de 2011");
        expect(result.citations?.[0].url).toBe("https://www.suin.gov.co/lei-1437-2011");
    });
    it("detects inline bibliography sentences", () => {
        const content = `
Análisis preliminar

Fuentes consultadas: [Decreto 1082 de 2015](https://www.funcionpublica.gov.co/decreto-1082) ; Resolución 123 del 2020 https://www.minjusticia.gov.co/res-123-2020
`;
        const result = (0, model_answer_1.parseModelAnswer)(content);
        expect(result.text).not.toContain("Fuentes consultadas");
        expect(result.citations?.length).toBe(2);
        expect(result.citations?.[0].title).toContain("Decreto 1082 de 2015");
        expect(result.citations?.[1].url).toBe("https://www.minjusticia.gov.co/res-123-2020");
    });
    it("uses backend bibliography when available", () => {
        const backendResult = (0, model_answer_1.parseModelAnswer)("Respuesta sin sección visible", {
            citationsFromBackend: [
                {
                    id: "foo",
                    title: "Ley 80 de 1993",
                    url: "https://www.suin.gov.co/ley-80-1993",
                    type: "ley",
                    description: "Contratación estatal"
                }
            ]
        });
        expect(backendResult.text).toBe("Respuesta sin sección visible");
        expect(backendResult.citations?.length).toBe(1);
        expect(backendResult.citations?.[0].title).toBe("Ley 80 de 1993");
        expect(backendResult.citations?.[0].type).toBe("ley");
    });
    it("returns clean text when no citations are present", () => {
        const content = "Respuesta directa sin referencias externas.";
        const result = (0, model_answer_1.parseModelAnswer)(content);
        expect(result.text).toBe(content);
        expect(result.citations).toBeUndefined();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxwZWRyb1xcRG9jdW1lbnRzXFxHaXRIdWJcXEFzaXN0ZW50ZS1MZWdhbC1JbnRlbGlnZW50ZVxcX190ZXN0c19fXFxsaWJcXHBhcnNlcnNcXG1vZGVsLWFuc3dlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsb0VBQW9FO0FBRXBFLE1BQU0sYUFBYSxHQUFHOzs7Ozs7OztDQVFyQixDQUFBO0FBRUQsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxFQUFFLENBQUMseURBQXlELEVBQUUsR0FBRyxFQUFFO1FBQ2pFLE1BQU0sTUFBTSxHQUFHLElBQUEsK0JBQWdCLEVBQUMsYUFBYSxDQUFDLENBQUE7UUFFOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMscUNBQXFDLENBQUMsQ0FBQTtRQUNwRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUE7UUFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtRQUM1RCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFBO0lBQ2pGLENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxNQUFNLE9BQU8sR0FBRzs7OztDQUluQixDQUFBO1FBQ0csTUFBTSxNQUFNLEdBQUcsSUFBQSwrQkFBZ0IsRUFBQyxPQUFPLENBQUMsQ0FBQTtRQUV4QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQTtRQUN4RCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtRQUNyRSxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFBO0lBQ3ZGLENBQUMsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtRQUNsRCxNQUFNLGFBQWEsR0FBRyxJQUFBLCtCQUFnQixFQUFDLCtCQUErQixFQUFFO1lBQ3RFLG9CQUFvQixFQUFFO2dCQUNwQjtvQkFDRSxFQUFFLEVBQUUsS0FBSztvQkFDVCxLQUFLLEVBQUUsZ0JBQWdCO29CQUN2QixHQUFHLEVBQUUscUNBQXFDO29CQUMxQyxJQUFJLEVBQUUsS0FBSztvQkFDWCxXQUFXLEVBQUUsc0JBQXNCO2lCQUNwQzthQUNGO1NBQ0YsQ0FBQyxDQUFBO1FBRUYsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQTtRQUNoRSxNQUFNLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDL0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUNqRSxNQUFNLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUN2RCxDQUFDLENBQUMsQ0FBQTtJQUVGLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxHQUFHLEVBQUU7UUFDMUQsTUFBTSxPQUFPLEdBQUcsNkNBQTZDLENBQUE7UUFDN0QsTUFBTSxNQUFNLEdBQUcsSUFBQSwrQkFBZ0IsRUFBQyxPQUFPLENBQUMsQ0FBQTtRQUV4QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNqQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFBO0lBQzFDLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxwZWRyb1xcRG9jdW1lbnRzXFxHaXRIdWJcXEFzaXN0ZW50ZS1MZWdhbC1JbnRlbGlnZW50ZVxcX190ZXN0c19fXFxsaWJcXHBhcnNlcnNcXG1vZGVsLWFuc3dlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhcnNlTW9kZWxBbnN3ZXIgfSBmcm9tIFwiLi4vLi4vLi4vbGliL3BhcnNlcnMvbW9kZWwtYW5zd2VyXCJcblxuY29uc3Qgc2FtcGxlQ29udGVudCA9IGBcblBsYW50ZWFtaWVudG8gZGVsIHByb2JsZW1hIGp1csOtZGljb1xuXG5FbCBNaW5pc3RlcmlvIFDDumJsaWNvIGNvbnN1bHRhIHNvYnJlIGxhIGFwbGljYWNpw7NuIGRlIGxhIExleSAxNDM3IGRlIDIwMTEuXG5cbiMjIEJpYmxpb2dyYWbDrWFcbi0gW0xleSAxNDM3IGRlIDIwMTFdKGh0dHBzOi8vd3d3LnN1aW4uZ292LmNvL2xlaS0xNDM3LTIwMTEpXG4tIFNlbnRlbmNpYSBULTEyMyBkZSAyMDE4IOKAlCBDb3J0ZSBDb25zdGl0dWNpb25hbCAoaHR0cHM6Ly93d3cuY29ydGVjb25zdGl0dWNpb25hbC5nb3YuY28vVC0xMjMtMTgpXG5gXG5cbmRlc2NyaWJlKFwicGFyc2VNb2RlbEFuc3dlclwiLCAoKSA9PiB7XG4gIGl0KFwic2VwYXJhdGVzIGJpYmxpb2dyYXBoeSBzZWN0aW9uIGFuZCBub3JtYWxpemVzIGNpdGF0aW9uc1wiLCAoKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gcGFyc2VNb2RlbEFuc3dlcihzYW1wbGVDb250ZW50KVxuXG4gICAgZXhwZWN0KHJlc3VsdC50ZXh0KS50b0NvbnRhaW4oXCJQbGFudGVhbWllbnRvIGRlbCBwcm9ibGVtYSBqdXLDrWRpY29cIilcbiAgICBleHBlY3QocmVzdWx0LnRleHQpLm5vdC50b0NvbnRhaW4oXCJCaWJsaW9ncmFmw61hXCIpXG4gICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnMpLnRvQmVEZWZpbmVkKClcbiAgICBleHBlY3QocmVzdWx0LmNpdGF0aW9ucz8ubGVuZ3RoKS50b0JlKDIpXG4gICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnM/LlswXS50aXRsZSkudG9CZShcIkxleSAxNDM3IGRlIDIwMTFcIilcbiAgICBleHBlY3QocmVzdWx0LmNpdGF0aW9ucz8uWzBdLnVybCkudG9CZShcImh0dHBzOi8vd3d3LnN1aW4uZ292LmNvL2xlaS0xNDM3LTIwMTFcIilcbiAgfSlcblxuICBpdChcImRldGVjdHMgaW5saW5lIGJpYmxpb2dyYXBoeSBzZW50ZW5jZXNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBgXG5BbsOhbGlzaXMgcHJlbGltaW5hclxuXG5GdWVudGVzIGNvbnN1bHRhZGFzOiBbRGVjcmV0byAxMDgyIGRlIDIwMTVdKGh0dHBzOi8vd3d3LmZ1bmNpb25wdWJsaWNhLmdvdi5jby9kZWNyZXRvLTEwODIpIDsgUmVzb2x1Y2nDs24gMTIzIGRlbCAyMDIwIGh0dHBzOi8vd3d3Lm1pbmp1c3RpY2lhLmdvdi5jby9yZXMtMTIzLTIwMjBcbmBcbiAgICBjb25zdCByZXN1bHQgPSBwYXJzZU1vZGVsQW5zd2VyKGNvbnRlbnQpXG5cbiAgICBleHBlY3QocmVzdWx0LnRleHQpLm5vdC50b0NvbnRhaW4oXCJGdWVudGVzIGNvbnN1bHRhZGFzXCIpXG4gICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnM/Lmxlbmd0aCkudG9CZSgyKVxuICAgIGV4cGVjdChyZXN1bHQuY2l0YXRpb25zPy5bMF0udGl0bGUpLnRvQ29udGFpbihcIkRlY3JldG8gMTA4MiBkZSAyMDE1XCIpXG4gICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnM/LlsxXS51cmwpLnRvQmUoXCJodHRwczovL3d3dy5taW5qdXN0aWNpYS5nb3YuY28vcmVzLTEyMy0yMDIwXCIpXG4gIH0pXG5cbiAgaXQoXCJ1c2VzIGJhY2tlbmQgYmlibGlvZ3JhcGh5IHdoZW4gYXZhaWxhYmxlXCIsICgpID0+IHtcbiAgICBjb25zdCBiYWNrZW5kUmVzdWx0ID0gcGFyc2VNb2RlbEFuc3dlcihcIlJlc3B1ZXN0YSBzaW4gc2VjY2nDs24gdmlzaWJsZVwiLCB7XG4gICAgICBjaXRhdGlvbnNGcm9tQmFja2VuZDogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwiZm9vXCIsXG4gICAgICAgICAgdGl0bGU6IFwiTGV5IDgwIGRlIDE5OTNcIixcbiAgICAgICAgICB1cmw6IFwiaHR0cHM6Ly93d3cuc3Vpbi5nb3YuY28vbGV5LTgwLTE5OTNcIixcbiAgICAgICAgICB0eXBlOiBcImxleVwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkNvbnRyYXRhY2nDs24gZXN0YXRhbFwiXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KVxuXG4gICAgZXhwZWN0KGJhY2tlbmRSZXN1bHQudGV4dCkudG9CZShcIlJlc3B1ZXN0YSBzaW4gc2VjY2nDs24gdmlzaWJsZVwiKVxuICAgIGV4cGVjdChiYWNrZW5kUmVzdWx0LmNpdGF0aW9ucz8ubGVuZ3RoKS50b0JlKDEpXG4gICAgZXhwZWN0KGJhY2tlbmRSZXN1bHQuY2l0YXRpb25zPy5bMF0udGl0bGUpLnRvQmUoXCJMZXkgODAgZGUgMTk5M1wiKVxuICAgIGV4cGVjdChiYWNrZW5kUmVzdWx0LmNpdGF0aW9ucz8uWzBdLnR5cGUpLnRvQmUoXCJsZXlcIilcbiAgfSlcblxuICBpdChcInJldHVybnMgY2xlYW4gdGV4dCB3aGVuIG5vIGNpdGF0aW9ucyBhcmUgcHJlc2VudFwiLCAoKSA9PiB7XG4gICAgY29uc3QgY29udGVudCA9IFwiUmVzcHVlc3RhIGRpcmVjdGEgc2luIHJlZmVyZW5jaWFzIGV4dGVybmFzLlwiXG4gICAgY29uc3QgcmVzdWx0ID0gcGFyc2VNb2RlbEFuc3dlcihjb250ZW50KVxuXG4gICAgZXhwZWN0KHJlc3VsdC50ZXh0KS50b0JlKGNvbnRlbnQpXG4gICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnMpLnRvQmVVbmRlZmluZWQoKVxuICB9KVxufSlcbiJdLCJ2ZXJzaW9uIjozfQ==