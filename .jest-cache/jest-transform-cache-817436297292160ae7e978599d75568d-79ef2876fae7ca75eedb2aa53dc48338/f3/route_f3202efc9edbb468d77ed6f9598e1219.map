{"version":3,"names":["cov_29ygzei6ne","actualCoverage","exports","POST","generate_local_embedding_1","s","require","generate_openrouter_embedding_1","server_chat_helpers_1","supabase_js_1","openai_1","__importDefault","request","f","json","userInput","fileIds","embeddingsProvider","sourceCount","b","console","log","uniqueFileIds","Set","supabaseAdmin","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","profile","getServerProfile","use_azure_openai","checkApiKey","azure_openai_api_key","openai_api_key","openrouter_api_key","error","message","chunks","openai","default","apiKey","baseURL","azure_openai_endpoint","azure_openai_embeddings_id","defaultQuery","defaultHeaders","organization","openai_organization_id","response","embeddings","create","model","input","openaiEmbedding","data","map","item","embedding","openaiFileItems","openaiError","rpc","query_embedding","match_count","file_ids","openrouterKey","OPENROUTER_API_KEY","openrouterEmbedding","generateOpenRouterEmbedding","openrouterFileItems","openrouterError","length","Error","localEmbedding","generateLocalEmbedding","localFileItems","localFileItemsError","mostSimilarChunks","sort","a","similarity","Response","JSON","stringify","results","status","errorMessage","errorCode"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\retrieval\\retrieve\\route.ts"],"sourcesContent":["import { generateLocalEmbedding } from \"@/lib/generate-local-embedding\"\r\nimport { generateOpenRouterEmbedding } from \"@/lib/generate-openrouter-embedding\"\r\nimport { checkApiKey, getServerProfile } from \"@/lib/server/server-chat-helpers\"\r\nimport { Database } from \"@/supabase/types\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\nimport OpenAI from \"openai\"\r\n\r\nexport async function POST(request: Request) {\r\n  const json = await request.json()\r\n  let { userInput, fileIds, embeddingsProvider, sourceCount } = json as {\r\n    userInput: string\r\n    fileIds: string[]\r\n    embeddingsProvider: \"openai\" | \"local\" | \"openrouter\"\r\n    sourceCount: number\r\n  }\r\n  \r\n  // üî• FORZAR OpenAI Embeddings para retrieval\r\n  // OpenRouter no tiene API de embeddings, local tiene problemas\r\n  if (embeddingsProvider === \"openrouter\" || embeddingsProvider === \"local\") {\r\n    embeddingsProvider = \"openai\"\r\n    console.log(\"üîç Cambiando a 'openai' para retrieval (m√°s confiable)\")\r\n  }\r\n\r\n  const uniqueFileIds = [...new Set(fileIds)]\r\n\r\n  try {\r\n    const supabaseAdmin = createClient<Database>(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n    )\r\n\r\n    const profile = await getServerProfile()\r\n\r\n    if (embeddingsProvider === \"openai\") {\r\n      if (profile.use_azure_openai) {\r\n        checkApiKey(profile.azure_openai_api_key, \"Azure OpenAI\")\r\n      } else {\r\n        checkApiKey(profile.openai_api_key, \"OpenAI\")\r\n      }\r\n    } else if (embeddingsProvider === \"openrouter\") {\r\n      try {\r\n        checkApiKey(profile.openrouter_api_key, \"OpenRouter\")\r\n      } catch (error: any) {\r\n        error.message =\r\n          error.message +\r\n          \", make sure it is configured or else use local embeddings\"\r\n        throw error\r\n      }\r\n    }\r\n\r\n    let chunks: any[] = []\r\n\r\n    let openai\r\n    if (profile.use_azure_openai) {\r\n      openai = new OpenAI({\r\n        apiKey: profile.azure_openai_api_key || \"\",\r\n        baseURL: `${profile.azure_openai_endpoint}/openai/deployments/${profile.azure_openai_embeddings_id}`,\r\n        defaultQuery: { \"api-version\": \"2023-12-01-preview\" },\r\n        defaultHeaders: { \"api-key\": profile.azure_openai_api_key }\r\n      })\r\n    } else {\r\n      openai = new OpenAI({\r\n        apiKey: profile.openai_api_key || \"\",\r\n        organization: profile.openai_organization_id\r\n      })\r\n    }\r\n\r\n    if (embeddingsProvider === \"openai\") {\r\n      const response = await openai.embeddings.create({\r\n        model: \"text-embedding-3-small\",\r\n        input: userInput\r\n      })\r\n\r\n      const openaiEmbedding = response.data.map(item => item.embedding)[0]\r\n\r\n      const { data: openaiFileItems, error: openaiError } =\r\n        await supabaseAdmin.rpc(\"match_file_items_openai\", {\r\n          query_embedding: openaiEmbedding as any,\r\n          match_count: sourceCount,\r\n          file_ids: uniqueFileIds\r\n        })\r\n\r\n      if (openaiError) {\r\n        throw openaiError\r\n      }\r\n\r\n      chunks = openaiFileItems\r\n    } else if (embeddingsProvider === \"openrouter\") {\r\n      try {\r\n        const openrouterKey = profile.openrouter_api_key || process.env.OPENROUTER_API_KEY\r\n        console.log('üîç Generando embedding de b√∫squeda con OpenRouter...')\r\n        \r\n        const openrouterEmbedding = await generateOpenRouterEmbedding(\r\n          userInput, \r\n          openrouterKey!, \r\n          'text-embedding-3-small'\r\n        )\r\n\r\n        console.log('‚úÖ Embedding generado, buscando en base de datos...')\r\n        \r\n        const { data: openrouterFileItems, error: openrouterError } =\r\n          await supabaseAdmin.rpc(\"match_file_items_openai\", {\r\n            query_embedding: openrouterEmbedding as any,\r\n            match_count: sourceCount,\r\n            file_ids: uniqueFileIds\r\n          })\r\n\r\n        if (openrouterError) {\r\n          console.error('‚ùå Error en b√∫squeda de Supabase:', openrouterError)\r\n          throw openrouterError\r\n        }\r\n\r\n        console.log(`‚úÖ Encontrados ${openrouterFileItems?.length || 0} chunks relevantes`)\r\n        chunks = openrouterFileItems\r\n      } catch (error) {\r\n        console.error('‚ùå OpenRouter retrieval error:', error)\r\n        throw new Error('Failed to retrieve with OpenRouter embeddings')\r\n      }\r\n    } else if (embeddingsProvider === \"local\") {\r\n      const localEmbedding = await generateLocalEmbedding(userInput)\r\n\r\n      const { data: localFileItems, error: localFileItemsError } =\r\n        await supabaseAdmin.rpc(\"match_file_items_local\", {\r\n          query_embedding: localEmbedding as any,\r\n          match_count: sourceCount,\r\n          file_ids: uniqueFileIds\r\n        })\r\n\r\n      if (localFileItemsError) {\r\n        throw localFileItemsError\r\n      }\r\n\r\n      chunks = localFileItems\r\n    }\r\n\r\n    const mostSimilarChunks = chunks?.sort(\r\n      (a, b) => b.similarity - a.similarity\r\n    )\r\n\r\n    return new Response(JSON.stringify({ results: mostSimilarChunks }), {\r\n      status: 200\r\n    })\r\n  } catch (error: any) {\r\n    const errorMessage = error.error?.message || \"An unexpected error occurred\"\r\n    const errorCode = error.status || 500\r\n    return new Response(JSON.stringify({ message: errorMessage }), {\r\n      status: errorCode\r\n    })\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}