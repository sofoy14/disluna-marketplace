{"file":"C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\__tests__\\lib\\verification\\continuous-verification-system.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\__tests__\\lib\\verification\\continuous-verification-system.test.ts"],"sourcesContent":["/**\r\n * Tests de Regresión - ContinuousVerificationSystem\r\n * \r\n * Tests críticos para asegurar que el sistema de verificación continua funciona correctamente\r\n * después de la refactorización, cumpliendo con requisitos de calidad legal.\r\n */\r\n\r\nimport { ContinuousVerificationSystem } from '../../lib/verification/continuous-verification-system'\r\nimport OpenAI from 'openai'\r\n\r\n// Mock del cliente OpenAI\r\nconst mockOpenAIClient = {\r\n  chat: {\r\n    completions: {\r\n      create: jest.fn()\r\n    }\r\n  }\r\n}\r\n\r\njest.mock('openai', () => {\r\n  return jest.fn().mockImplementation(() => mockOpenAIClient)\r\n})\r\n\r\ndescribe('ContinuousVerificationSystem - Tests de Regresión', () => {\r\n  let verificationSystem: ContinuousVerificationSystem\r\n  const mockClient = new OpenAI({ apiKey: 'test-key' })\r\n\r\n  beforeEach(() => {\r\n    verificationSystem = new ContinuousVerificationSystem(mockClient, 'gpt-4')\r\n    jest.clearAllMocks()\r\n  })\r\n\r\n  describe('Verificación Pre-Búsqueda', () => {\r\n    test('debe validar consulta legal antes de búsqueda', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS en Colombia?'\r\n      \r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.95,\r\n              legalRelevance: 0.9,\r\n              complexity: 'medium',\r\n              recommendedSearchStrategy: 'iter_research',\r\n              potentialIssues: [],\r\n              suggestions: [\r\n                'Buscar información sobre Código de Comercio',\r\n                'Consultar normativa de DIAN',\r\n                'Verificar requisitos de capital mínimo'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSearch(userQuery)\r\n\r\n      expect(result.isValid).toBe(true)\r\n      expect(result.confidence).toBeGreaterThan(0.9)\r\n      expect(result.legalRelevance).toBeGreaterThan(0.8)\r\n      expect(result.recommendedSearchStrategy).toBe('iter_research')\r\n      expect(result.suggestions).toHaveLength(3)\r\n    })\r\n\r\n    test('debe detectar consultas no legales', async () => {\r\n      const userQuery = '¿Cómo cocinar una paella valenciana?'\r\n      \r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: false,\r\n              confidence: 0.1,\r\n              legalRelevance: 0.0,\r\n              complexity: 'low',\r\n              recommendedSearchStrategy: 'none',\r\n              potentialIssues: [\r\n                'Consulta no relacionada con derecho',\r\n                'Fuera del ámbito legal colombiano'\r\n              ],\r\n              suggestions: [\r\n                'Esta consulta no requiere búsqueda legal',\r\n                'Considere usar un asistente culinario'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSearch(userQuery)\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.legalRelevance).toBe(0)\r\n      expect(result.recommendedSearchStrategy).toBe('none')\r\n      expect(result.potentialIssues).toContain('Consulta no relacionada con derecho')\r\n    })\r\n\r\n    test('debe detectar consultas legales complejas', async () => {\r\n      const userQuery = '¿Cómo estructurar una fusión entre una SAS colombiana y una LLC estadounidense considerando tratados de doble tributación y regulaciones de inversión extranjera?'\r\n      \r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.9,\r\n              legalRelevance: 0.95,\r\n              complexity: 'high',\r\n              recommendedSearchStrategy: 'iter_research',\r\n              potentialIssues: [\r\n                'Consulta muy compleja',\r\n                'Requiere múltiples áreas de derecho',\r\n                'Necesita fuentes especializadas'\r\n              ],\r\n              suggestions: [\r\n                'Buscar normativa de fusiones internacionales',\r\n                'Consultar tratados de doble tributación',\r\n                'Verificar regulaciones de inversión extranjera',\r\n                'Considerar consulta legal profesional'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSearch(userQuery)\r\n\r\n      expect(result.isValid).toBe(true)\r\n      expect(result.complexity).toBe('high')\r\n      expect(result.potentialIssues).toContain('Consulta muy compleja')\r\n      expect(result.suggestions).toContain('Considerar consulta legal profesional')\r\n    })\r\n  })\r\n\r\n  describe('Verificación Durante Búsqueda', () => {\r\n    test('debe validar fuentes encontradas durante búsqueda', async () => {\r\n      const searchQuery = 'constitución SAS Colombia'\r\n      const searchResults = [\r\n        {\r\n          title: 'Código de Comercio - Artículo 110',\r\n          url: 'https://www.suin-juriscol.gov.co/viewDocument.asp?ruta=Leyes/1689347',\r\n          snippet: 'Para constituir una sociedad por acciones simplificada...',\r\n          type: 'official' as const,\r\n          quality: 9\r\n        },\r\n        {\r\n          title: 'Guía de Constitución de Empresas',\r\n          url: 'https://www.example-blog.com',\r\n          snippet: 'Información general sobre empresas...',\r\n          type: 'general' as const,\r\n          quality: 3\r\n        }\r\n      ]\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.8,\r\n              qualityScore: 0.85,\r\n              sourceEvaluation: {\r\n                official: {\r\n                  count: 1,\r\n                  averageQuality: 9,\r\n                  relevance: 0.95\r\n                },\r\n                general: {\r\n                  count: 1,\r\n                  averageQuality: 3,\r\n                  relevance: 0.4\r\n                }\r\n              },\r\n              recommendations: [\r\n                'Priorizar fuentes oficiales',\r\n                'Descartar fuentes de baja calidad',\r\n                'Buscar más fuentes oficiales si es necesario'\r\n              ],\r\n              issues: [\r\n                'Una fuente de baja calidad encontrada'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyDuringSearch(searchQuery, searchResults)\r\n\r\n      expect(result.isValid).toBe(true)\r\n      expect(result.qualityScore).toBeGreaterThan(0.8)\r\n      expect(result.sourceEvaluation.official.count).toBe(1)\r\n      expect(result.sourceEvaluation.official.averageQuality).toBe(9)\r\n      expect(result.issues).toContain('Una fuente de baja calidad encontrada')\r\n    })\r\n\r\n    test('debe detectar fuentes insuficientes', async () => {\r\n      const searchQuery = 'normativa tributaria empresas extranjeras'\r\n      const searchResults = [\r\n        {\r\n          title: 'Información General',\r\n          url: 'https://www.example.com',\r\n          snippet: 'Información básica...',\r\n          type: 'general' as const,\r\n          quality: 2\r\n        }\r\n      ]\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: false,\r\n              confidence: 0.3,\r\n              qualityScore: 0.2,\r\n              sourceEvaluation: {\r\n                general: {\r\n                  count: 1,\r\n                  averageQuality: 2,\r\n                  relevance: 0.3\r\n                }\r\n              },\r\n              recommendations: [\r\n                'Buscar fuentes oficiales de DIAN',\r\n                'Consultar normativa específica',\r\n                'Considerar fuentes académicas especializadas'\r\n              ],\r\n              issues: [\r\n                'Fuentes insuficientes',\r\n                'Calidad muy baja',\r\n                'Falta de fuentes oficiales'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyDuringSearch(searchQuery, searchResults)\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.qualityScore).toBeLessThan(0.5)\r\n      expect(result.issues).toContain('Fuentes insuficientes')\r\n      expect(result.recommendations).toContain('Buscar fuentes oficiales de DIAN')\r\n    })\r\n  })\r\n\r\n  describe('Verificación Post-Búsqueda', () => {\r\n    test('debe evaluar suficiencia de información encontrada', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS?'\r\n      const sources = [\r\n        {\r\n          title: 'Código de Comercio - Artículo 110',\r\n          url: 'https://www.suin-juriscol.gov.co',\r\n          content: 'Para constituir una sociedad por acciones simplificada se requiere...',\r\n          type: 'official' as const,\r\n          quality: 9,\r\n          authority: 'maxima' as const\r\n        },\r\n        {\r\n          title: 'DIAN - Requisitos Tributarios',\r\n          url: 'https://www.dian.gov.co',\r\n          content: 'Requisitos tributarios para SAS...',\r\n          type: 'official' as const,\r\n          quality: 8,\r\n          authority: 'maxima' as const\r\n        }\r\n      ]\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isSufficient: true,\r\n              confidence: 0.9,\r\n              completenessScore: 0.85,\r\n              qualityScore: 0.9,\r\n              coverage: {\r\n                legal: 0.9,\r\n                procedural: 0.8,\r\n                practical: 0.7\r\n              },\r\n              missingInfo: [],\r\n              recommendations: [\r\n                'Información suficiente para responder',\r\n                'Fuentes oficiales de alta calidad'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPostSearch(userQuery, sources)\r\n\r\n      expect(result.isSufficient).toBe(true)\r\n      expect(result.confidence).toBeGreaterThan(0.8)\r\n      expect(result.completenessScore).toBeGreaterThan(0.8)\r\n      expect(result.qualityScore).toBeGreaterThan(0.8)\r\n      expect(result.missingInfo).toHaveLength(0)\r\n    })\r\n\r\n    test('debe detectar información insuficiente', async () => {\r\n      const userQuery = '¿Cómo estructurar una fusión internacional compleja?'\r\n      const sources = [\r\n        {\r\n          title: 'Información Básica sobre Fusiones',\r\n          url: 'https://www.example.com',\r\n          content: 'Información general sobre fusiones...',\r\n          type: 'general' as const,\r\n          quality: 4,\r\n          authority: 'baja' as const\r\n        }\r\n      ]\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isSufficient: false,\r\n              confidence: 0.3,\r\n              completenessScore: 0.3,\r\n              qualityScore: 0.4,\r\n              coverage: {\r\n                legal: 0.2,\r\n                procedural: 0.1,\r\n                practical: 0.3\r\n              },\r\n              missingInfo: [\r\n                'Normativa específica de fusiones internacionales',\r\n                'Tratados de doble tributación',\r\n                'Regulaciones de inversión extranjera',\r\n                'Procedimientos específicos'\r\n              ],\r\n              recommendations: [\r\n                'Buscar normativa específica',\r\n                'Consultar fuentes oficiales especializadas',\r\n                'Considerar consulta legal profesional'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPostSearch(userQuery, sources)\r\n\r\n      expect(result.isSufficient).toBe(false)\r\n      expect(result.confidence).toBeLessThan(0.5)\r\n      expect(result.missingInfo).toHaveLength(4)\r\n      expect(result.recommendations).toContain('Considerar consulta legal profesional')\r\n    })\r\n  })\r\n\r\n  describe('Verificación Pre-Síntesis', () => {\r\n    test('debe validar información antes de generar respuesta', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS?'\r\n      const sources = [\r\n        {\r\n          title: 'Código de Comercio - Artículo 110',\r\n          url: 'https://www.suin-juriscol.gov.co',\r\n          content: 'Para constituir una sociedad por acciones simplificada se requiere un capital mínimo de $1,000,000...',\r\n          type: 'official' as const,\r\n          quality: 9,\r\n          authority: 'maxima' as const\r\n        }\r\n      ]\r\n      const draftResponse = 'Para constituir una SAS en Colombia se requiere un capital mínimo de $1,000,000 según el Artículo 110 del Código de Comercio...'\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.95,\r\n              accuracyScore: 0.9,\r\n              completenessScore: 0.85,\r\n              sourceAlignment: 0.95,\r\n              issues: [],\r\n              recommendations: [\r\n                'Respuesta bien fundamentada',\r\n                'Información precisa y completa'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSynthesis(userQuery, sources, draftResponse)\r\n\r\n      expect(result.isValid).toBe(true)\r\n      expect(result.confidence).toBeGreaterThan(0.9)\r\n      expect(result.accuracyScore).toBeGreaterThan(0.8)\r\n      expect(result.sourceAlignment).toBeGreaterThan(0.9)\r\n      expect(result.issues).toHaveLength(0)\r\n    })\r\n\r\n    test('debe detectar desalineación entre fuentes y respuesta', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS?'\r\n      const sources = [\r\n        {\r\n          title: 'Código de Comercio - Artículo 110',\r\n          url: 'https://www.suin-juriscol.gov.co',\r\n          content: 'Para constituir una sociedad por acciones simplificada se requiere un capital mínimo de $1,000,000...',\r\n          type: 'official' as const,\r\n          quality: 9,\r\n          authority: 'maxima' as const\r\n        }\r\n      ]\r\n      const draftResponse = 'Para constituir una SAS se requiere un capital mínimo de $5,000,000...'\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: false,\r\n              confidence: 0.2,\r\n              accuracyScore: 0.3,\r\n              completenessScore: 0.7,\r\n              sourceAlignment: 0.2,\r\n              issues: [\r\n                'Capital mínimo incorrecto en respuesta',\r\n                'Desalineación con fuente oficial'\r\n              ],\r\n              recommendations: [\r\n                'Corregir capital mínimo a $1,000,000',\r\n                'Verificar información con fuentes oficiales'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSynthesis(userQuery, sources, draftResponse)\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.sourceAlignment).toBeLessThan(0.5)\r\n      expect(result.issues).toContain('Capital mínimo incorrecto en respuesta')\r\n    })\r\n  })\r\n\r\n  describe('Verificación Post-Síntesis', () => {\r\n    test('debe validar respuesta final generada', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS?'\r\n      const sources = [\r\n        {\r\n          title: 'Código de Comercio - Artículo 110',\r\n          url: 'https://www.suin-juriscol.gov.co',\r\n          content: 'Para constituir una sociedad por acciones simplificada se requiere...',\r\n          type: 'official' as const,\r\n          quality: 9,\r\n          authority: 'maxima' as const\r\n        }\r\n      ]\r\n      const finalResponse = 'Para constituir una SAS en Colombia se requiere: 1) Capital mínimo de $1,000,000, 2) Mínimo 1 socio, 3) Documentos constitutivos según Artículo 110 del Código de Comercio...'\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.95,\r\n              finalScore: 0.9,\r\n              qualityMetrics: {\r\n                accuracy: 0.95,\r\n                completeness: 0.9,\r\n                clarity: 0.85,\r\n                legalCompliance: 0.95\r\n              },\r\n              verificationChecks: {\r\n                sourceAlignment: true,\r\n                legalAccuracy: true,\r\n                completeness: true,\r\n                clarity: true\r\n              },\r\n              recommendations: [\r\n                'Respuesta de alta calidad',\r\n                'Bien fundamentada en fuentes oficiales'\r\n              ],\r\n              warnings: []\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPostSynthesis(userQuery, sources, finalResponse)\r\n\r\n      expect(result.isValid).toBe(true)\r\n      expect(result.finalScore).toBeGreaterThan(0.8)\r\n      expect(result.qualityMetrics.accuracy).toBeGreaterThan(0.9)\r\n      expect(result.verificationChecks.sourceAlignment).toBe(true)\r\n      expect(result.warnings).toHaveLength(0)\r\n    })\r\n\r\n    test('debe detectar problemas en respuesta final', async () => {\r\n      const userQuery = '¿Cuáles son los requisitos para constituir una SAS?'\r\n      const sources = [\r\n        {\r\n          title: 'Código de Comercio',\r\n          url: 'https://www.suin-juriscol.gov.co',\r\n          content: 'Información básica...',\r\n          type: 'official' as const,\r\n          quality: 6,\r\n          authority: 'alta' as const\r\n        }\r\n      ]\r\n      const finalResponse = 'Para constituir una SAS necesitas dinero y documentos.'\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: false,\r\n              confidence: 0.3,\r\n              finalScore: 0.4,\r\n              qualityMetrics: {\r\n                accuracy: 0.6,\r\n                completeness: 0.3,\r\n                clarity: 0.4,\r\n                legalCompliance: 0.5\r\n              },\r\n              verificationChecks: {\r\n                sourceAlignment: false,\r\n                legalAccuracy: false,\r\n                completeness: false,\r\n                clarity: false\r\n              },\r\n              recommendations: [\r\n                'Mejorar nivel de detalle',\r\n                'Incluir información específica',\r\n                'Mejorar claridad de la respuesta'\r\n              ],\r\n              warnings: [\r\n                'Respuesta demasiado general',\r\n                'Falta información específica',\r\n                'No cumple estándares de calidad legal'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPostSynthesis(userQuery, sources, finalResponse)\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.finalScore).toBeLessThan(0.5)\r\n      expect(result.warnings).toContain('Respuesta demasiado general')\r\n      expect(result.verificationChecks.completeness).toBe(false)\r\n    })\r\n  })\r\n\r\n  describe('Evaluación de Jerarquía de Fuentes', () => {\r\n    test('debe priorizar fuentes oficiales correctamente', async () => {\r\n      const sources = [\r\n        {\r\n          title: 'Corte Constitucional - Sentencia T-123',\r\n          url: 'https://www.corteconstitucional.gov.co',\r\n          content: 'Sentencia de la Corte Constitucional...',\r\n          type: 'official' as const,\r\n          quality: 10,\r\n          authority: 'maxima' as const\r\n        },\r\n        {\r\n          title: 'Blog Legal Personal',\r\n          url: 'https://www.blog-legal.com',\r\n          content: 'Opinión personal sobre derecho...',\r\n          type: 'general' as const,\r\n          quality: 2,\r\n          authority: 'minima' as const\r\n        }\r\n      ]\r\n\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.8,\r\n              qualityScore: 0.85,\r\n              sourceHierarchy: {\r\n                maxima: 1,\r\n                alta: 0,\r\n                media: 0,\r\n                baja: 0,\r\n                minima: 1\r\n              },\r\n              recommendations: [\r\n                'Priorizar fuente de Corte Constitucional',\r\n                'Descartar fuente de blog personal',\r\n                'Buscar más fuentes oficiales'\r\n              ]\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyDuringSearch('test query', sources)\r\n\r\n      expect(result.sourceHierarchy?.maxima).toBe(1)\r\n      expect(result.sourceHierarchy?.minima).toBe(1)\r\n      expect(result.recommendations).toContain('Priorizar fuente de Corte Constitucional')\r\n    })\r\n  })\r\n\r\n  describe('Manejo de Errores', () => {\r\n    test('debe manejar errores de API gracefully', async () => {\r\n      mockOpenAIClient.chat.completions.create.mockRejectedValueOnce(\r\n        new Error('API timeout')\r\n      )\r\n\r\n      const result = await verificationSystem.verifyPreSearch('test query')\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.confidence).toBe(0)\r\n      expect(result.error).toContain('API timeout')\r\n    })\r\n\r\n    test('debe manejar respuestas malformadas', async () => {\r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: 'Respuesta no válida en JSON'\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSearch('test query')\r\n\r\n      expect(result.isValid).toBe(false)\r\n      expect(result.error).toContain('Error parsing verification response')\r\n    })\r\n  })\r\n\r\n  describe('Cumplimiento Legal', () => {\r\n    test('debe registrar todas las verificaciones para auditoría', async () => {\r\n      const userQuery = 'Consulta legal'\r\n      \r\n      mockOpenAIClient.chat.completions.create.mockResolvedValueOnce({\r\n        choices: [{\r\n          message: {\r\n            content: JSON.stringify({\r\n              isValid: true,\r\n              confidence: 0.9,\r\n              legalRelevance: 0.9,\r\n              complexity: 'medium',\r\n              recommendedSearchStrategy: 'iter_research',\r\n              potentialIssues: [],\r\n              suggestions: []\r\n            })\r\n          }\r\n        }]\r\n      })\r\n\r\n      const result = await verificationSystem.verifyPreSearch(userQuery)\r\n\r\n      expect(result.timestamp).toBeInstanceOf(Date)\r\n      expect(result.queryHash).toBeDefined()\r\n    })\r\n\r\n    test('debe mantener trazabilidad completa del proceso', async () => {\r\n      const userQuery = 'Consulta legal completa'\r\n      const sources = []\r\n      const response = 'Respuesta legal'\r\n\r\n      // Mock para todas las verificaciones\r\n      mockOpenAIClient.chat.completions.create\r\n        .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ isValid: true, confidence: 0.9 }) } }] })\r\n        .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ isValid: true, qualityScore: 0.8 }) } }] })\r\n        .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ isSufficient: true, confidence: 0.9 }) } }] })\r\n        .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ isValid: true, confidence: 0.9 }) } }] })\r\n        .mockResolvedValueOnce({ choices: [{ message: { content: JSON.stringify({ isValid: true, finalScore: 0.9 }) } }] })\r\n\r\n      const preSearch = await verificationSystem.verifyPreSearch(userQuery)\r\n      const duringSearch = await verificationSystem.verifyDuringSearch(userQuery, sources)\r\n      const postSearch = await verificationSystem.verifyPostSearch(userQuery, sources)\r\n      const preSynthesis = await verificationSystem.verifyPreSynthesis(userQuery, sources, response)\r\n      const postSynthesis = await verificationSystem.verifyPostSynthesis(userQuery, sources, response)\r\n\r\n      // Verificar que todas las verificaciones tienen timestamps únicos\r\n      expect(preSearch.timestamp).toBeInstanceOf(Date)\r\n      expect(duringSearch.timestamp).toBeInstanceOf(Date)\r\n      expect(postSearch.timestamp).toBeInstanceOf(Date)\r\n      expect(preSynthesis.timestamp).toBeInstanceOf(Date)\r\n      expect(postSynthesis.timestamp).toBeInstanceOf(Date)\r\n    })\r\n  })\r\n})\r\n"],"version":3}