{"version":3,"names":["cov_4mu1b8g3z","actualCoverage","exports","POST","chat_setting_limits_1","s","require","server_chat_helpers_1","openai_1","__importDefault","runtime","request","f","json","input","profile","getServerProfile","checkApiKey","openai_api_key","openai","default","apiKey","b","organization","openai_organization_id","response","chat","completions","create","model","messages","role","content","temperature","max_tokens","CHAT_SETTING_LIMITS","MAX_TOKEN_OUTPUT_LENGTH","choices","message","Response","JSON","stringify","status","error","errorMessage","errorCode"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\app\\api\\command\\route.ts"],"sourcesContent":["import { CHAT_SETTING_LIMITS } from \"@/lib/chat-setting-limits\"\r\nimport { checkApiKey, getServerProfile } from \"@/lib/server/server-chat-helpers\"\r\nimport OpenAI from \"openai\"\r\n\r\nexport const runtime = \"edge\"\r\n\r\nexport async function POST(request: Request) {\r\n  const json = await request.json()\r\n  const { input } = json as {\r\n    input: string\r\n  }\r\n\r\n  try {\r\n    const profile = await getServerProfile()\r\n\r\n    checkApiKey(profile.openai_api_key, \"OpenAI\")\r\n\r\n    const openai = new OpenAI({\r\n      apiKey: profile.openai_api_key || \"\",\r\n      organization: profile.openai_organization_id\r\n    })\r\n\r\n    const response = await openai.chat.completions.create({\r\n      model: \"gpt-4-1106-preview\",\r\n      messages: [\r\n        {\r\n          role: \"system\",\r\n          content: \"Respond to the user.\"\r\n        },\r\n        {\r\n          role: \"user\",\r\n          content: input\r\n        }\r\n      ],\r\n      temperature: 0,\r\n      max_tokens:\r\n        CHAT_SETTING_LIMITS[\"gpt-4-turbo-preview\"].MAX_TOKEN_OUTPUT_LENGTH\r\n      //   response_format: { type: \"json_object\" }\r\n      //   stream: true\r\n    })\r\n\r\n    const content = response.choices[0].message.content\r\n\r\n    return new Response(JSON.stringify({ content }), {\r\n      status: 200\r\n    })\r\n  } catch (error: any) {\r\n    const errorMessage = error.error?.message || \"An unexpected error occurred\"\r\n    const errorCode = error.status || 500\r\n    return new Response(JSON.stringify({ message: errorMessage }), {\r\n      status: errorCode\r\n    })\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}