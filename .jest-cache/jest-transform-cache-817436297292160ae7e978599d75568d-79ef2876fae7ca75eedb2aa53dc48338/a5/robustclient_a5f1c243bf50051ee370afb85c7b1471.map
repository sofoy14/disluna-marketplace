{"version":3,"names":["cov_2oqiji8d3v","actualCoverage","s","exports","verifySupabaseConnection","getServerSupabaseConfig","ssr_1","require","getSupabaseConfig","f","url","process","env","NEXT_PUBLIC_SUPABASE_URL","anonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","b","Error","startsWith","includes","_supabaseClient","supabase","Proxy","get","target","prop","console","log","substring","hasAnonKey","createBrowserClient","error","value","bind","data","from","select","limit","message","serviceRoleKey","SUPABASE_SERVICE_ROLE_KEY"],"sources":["C:\\Users\\pedro\\Documents\\GitHub\\Asistente-Legal-Inteligente\\lib\\supabase\\robust-client.ts"],"sourcesContent":["import { Database } from \"@/supabase/types\"\r\nimport { createBrowserClient } from \"@supabase/ssr\"\r\n\r\n// Funci√≥n para obtener configuraci√≥n robusta de Supabase\r\nfunction getSupabaseConfig() {\r\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n\r\n  if (!url || !anonKey) {\r\n    throw new Error(\r\n      'Missing Supabase configuration. Please check your environment variables:\\n' +\r\n      '- NEXT_PUBLIC_SUPABASE_URL\\n' +\r\n      '- NEXT_PUBLIC_SUPABASE_ANON_KEY'\r\n    )\r\n  }\r\n\r\n  // Verificar que la URL sea v√°lida\r\n  if (!url.startsWith('https://') || !url.includes('.supabase.co')) {\r\n    throw new Error(\r\n      `Invalid Supabase URL: ${url}\\n` +\r\n      'Expected format: https://your-project-id.supabase.co'\r\n    )\r\n  }\r\n\r\n  return { url, anonKey }\r\n}\r\n\r\n// Variable para cachear el cliente\r\nlet _supabaseClient: ReturnType<typeof createBrowserClient<Database>> | null = null\r\n\r\n// Cliente de Supabase robusto con lazy initialization\r\nexport const supabase = (() => {\r\n  // Retornar proxy que crea el cliente solo cuando se necesita\r\n  return new Proxy({} as ReturnType<typeof createBrowserClient<Database>>, {\r\n    get(target, prop) {\r\n      // Crear cliente solo cuando se accede por primera vez\r\n      if (!_supabaseClient) {\r\n        try {\r\n          const { url, anonKey } = getSupabaseConfig()\r\n          \r\n          console.log('üîß Configurando cliente de Supabase:', {\r\n            url: url.substring(0, 30) + '...',\r\n            hasAnonKey: !!anonKey\r\n          })\r\n\r\n          _supabaseClient = createBrowserClient<Database>(url, anonKey)\r\n        } catch (error) {\r\n          console.error('‚ùå Error configurando Supabase:', error)\r\n          throw error\r\n        }\r\n      }\r\n      \r\n      const value = (_supabaseClient as any)[prop]\r\n      return typeof value === 'function' ? value.bind(_supabaseClient) : value\r\n    }\r\n  })\r\n})()\r\n\r\n// Funci√≥n para verificar la conexi√≥n\r\nexport async function verifySupabaseConnection() {\r\n  try {\r\n    const { data, error } = await supabase.from('profiles').select('count').limit(1)\r\n    \r\n    if (error) {\r\n      throw new Error(`Supabase connection failed: ${error.message}`)\r\n    }\r\n\r\n    console.log('‚úÖ Conexi√≥n con Supabase verificada exitosamente')\r\n    return true\r\n  } catch (error) {\r\n    console.error('‚ùå Error verificando conexi√≥n con Supabase:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Funci√≥n para obtener configuraci√≥n de Supabase para el servidor\r\nexport function getServerSupabaseConfig() {\r\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n  if (!url || !serviceRoleKey) {\r\n    throw new Error(\r\n      'Missing Supabase server configuration. Please check your environment variables:\\n' +\r\n      '- NEXT_PUBLIC_SUPABASE_URL\\n' +\r\n      '- SUPABASE_SERVICE_ROLE_KEY'\r\n    )\r\n  }\r\n\r\n  return { url, serviceRoleKey }\r\n}\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}